---
title: Часть 3. Настройка межплатформенного решения Xamarin
description: В этом документе описывается настройка кросс-платформенного решения в Xamarin. В нем обсуждаются различные стратегии совместного использования кода, такие как общие проекты и .NET Standard.
ms.prod: xamarin
ms.assetid: 4139A6C2-D477-C563-C1AB-98CCD0D10A93
author: conceptdev
ms.author: crdun
ms.date: 03/27/2017
ms.openlocfilehash: f8b8f13f323f404554ca73c3e75c23713e0fbe35
ms.sourcegitcommit: 933de144d1fbe7d412e49b743839cae4bfcac439
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/04/2019
ms.locfileid: "70288849"
---
# <a name="part-3---setting-up-a-xamarin-cross-platform-solution"></a>Часть 3. Настройка межплатформенного решения Xamarin

Независимо от того, какие платформы используются, проекты Xamarin используют один и тот же формат файла решения (формат файла Visual Studio **. sln** ). Решения могут совместно использоваться в разных средах разработки, даже если не удается загрузить отдельные проекты (например, проект Windows в Visual Studio для Mac).



При создании нового кросс-платформенного приложения первым шагом является создание пустого решения. В этом разделе объясняется, что происходит дальше: Настройка проектов для создания кросс-платформенных мобильных приложений.

 <a name="Sharing_Code" />


## <a name="sharing-code"></a>Общий доступ к коду

Подробное описание реализации совместного использования кода на разных платформах см. в документе с [вариантами совместного использования кода](~/cross-platform/app-fundamentals/code-sharing.md) .

 <a name="Shared_Asset_Projects" />


### <a name="shared-projects"></a>Общие проекты

Самый простой подход к совместному использованию файлов кода — использовать [общий проект](~/cross-platform/app-fundamentals/shared-projects.md).

Этот метод позволяет совместно использовать один и тот же код в разных проектах платформы и использовать директивы компилятора для включения различных путей кода, зависящих от платформы.

 <a name="Portable_Class_Libraries" />


### <a name="portable-class-libraries-pcl"></a>Переносимые библиотеки классов (PCL)

Исторически файл проекта .NET (и результирующая сборка) нацелен на конкретную версию платформы. Это предотвращает совместное применение проекта или сборки разными платформами.

Переносимая библиотека классов (PCL) — это особый тип проекта, который можно использовать на различных платформах CLI, таких как Xamarin. iOS и Xamarin. Android, а также в WPF, универсальная платформа Windows и Xbox. Библиотека может использовать только часть полной платформы .NET Framework, ограниченную целевыми платформами.

Вы можете ознакомиться с дополнительными сведениями о [поддержке Xamarin для переносимых библиотек классов](~/cross-platform/app-fundamentals/pcl.md) и следовать инструкциям, чтобы увидеть, как работает [образец таскипортабле](https://github.com/xamarin/mobile-samples/tree/master/TaskyPortable) .


### <a name="net-standard"></a>.NET Standard

[.NET Standard](~/cross-platform/app-fundamentals/net-standard.md) проекты, появившиеся в 2016, предоставляют простой способ совместного использования кода на разных платформах, создавая сборки, которые можно использовать в Windows, платформах Xamarin (iOS, Android, Mac) и Linux.

.NET Standard библиотеки можно создавать и использовать, как и PCL, за исключением того, что интерфейсы API, доступные в каждой версии (от 1,0 до 1,6), более легко обнаруживаются, и каждая версия имеет обратную совместимость с более низкими номерами версий.



 <a name="Populating_the_Solution" />


## <a name="populating-the-solution"></a>Заполнение решения

Независимо от того, какой метод используется для совместного использования кода, Общая структура решения должна реализовывать многоуровневую архитектуру, которая способствует совместному использованию кода.
Подход Xamarin заключается в группировании кода на два типа проектов:

- **Основной проект** — запись повторно используемого кода в одном месте для совместного использования на разных платформах. Используйте принципы инкапсуляции, чтобы скрыть детали реализации везде, где это возможно.
- **Проекты приложений для конкретных платформ** — использование повторно используемого кода с минимальными возможными связываниями. Компоненты, зависящие от платформы, добавляются на этом уровне, построенные на основе компонентов, доступных в основном проекте.


 <a name="Core_Project" />


### <a name="core-project"></a>Основной проект

Проекты общего кода должны ссылаться только на сборки, доступные на всех платформах — IE. Общие пространства имен платформы, такие `System`как `System.Core` , `System.Xml`и.

Общие проекты должны реализовывать как можно больше функций, не связанных с интерфейсом пользователя, что может включать следующие уровни:

- **Уровень данных** — код, который принимает на себя хранение физических данных, например.  [SQLite-NET](https://github.com/praeclarum/sqlite-net), альтернативная база данных, например [realm.IO](https://realm.io/products/realm-mobile-database/) или даже XML-файлы. Классы уровня данных обычно используются только на уровне доступа к данным.
- **Уровень доступа к данным** — определяет API, который поддерживает необходимые операции с данными для функциональности приложения, такие как методы для доступа к спискам данных, отдельные элементы данных, а также их создание, изменение и удаление.
- **Уровень доступа к службам** — дополнительный слой для предоставления приложению облачных служб. Содержит код, обращающийся к удаленным сетевым ресурсам (веб-службам, загрузкам образов и т. д.) и, возможно, кэширование результатов.
- **Бизнес-уровень** — определение классов модели, а также классов фасадной или Manager, которые предоставляют функциональные возможности для приложений, зависящих от платформы.


 <a name="Platform-Specific_Application_Projects" />


### <a name="platform-specific-application-projects"></a>Проекты приложений для конкретных платформ

Проекты, зависящие от платформы, должны ссылаться на сборки, необходимые для привязки к пакету SDK для каждой платформы (Xamarin. iOS, Xamarin. Android, Xamarin. Mac или Windows), а также к базовому проекту общего кода.

Проекты, зависящие от платформы, должны реализовывать:

- **Уровень приложения** — функции, связанные с платформой, а также привязка и преобразование между объектами бизнес-уровня и пользовательским интерфейсом.
- **Уровень пользовательского интерфейса** — экраны, пользовательские элементы управления пользовательского интерфейса, представление логики проверки.


<a name="Example" />


### <a name="example"></a>Пример

Архитектура приложения показана на этой схеме:

 [![](setting-up-a-xamarin-cross-platform-solution-images/conceptualarchitecture.png "Архитектура приложения показана на этой схеме")](setting-up-a-xamarin-cross-platform-solution-images/conceptualarchitecture.png#lightbox)

На этом снимке экрана показана настройка решения с общими базовыми проектами проектов приложений, iOS и Android. Общий проект содержит код, относящийся к каждому из архитектурных уровней (бизнес, служба, данные и код доступа к данным):

 ![](setting-up-a-xamarin-cross-platform-solution-images/core-solution-example.png "В общем проекте содержится код, относящийся к каждому из архитектурных уровней (бизнес, служба, данные и код доступа к данным).")


 <a name="Project_References" />


## <a name="project-references"></a>Ссылки проекта

Ссылки проекта отражать зависимости для проекта. Базовые проекты ограничивают свои ссылки на общие сборки, чтобы код был легко обмениваться.
Проекты приложений для конкретных платформ ссылаются на общий код, а также на любые другие зависящие от платформы сборки, необходимые для использования преимуществ целевой платформы.

Приложение Проецирует каждый общий проект ссылки и содержит код пользовательского интерфейса, необходимый для представления функциональных возможностей пользователю, как показано на снимках экрана:

![](setting-up-a-xamarin-cross-platform-solution-images/solution-android.png "Приложение проекты каждой ссылки на общий проект") ![](setting-up-a-xamarin-cross-platform-solution-images/solution-ios.png "приложение проекты каждой ссылки на общий проект")


Конкретные примеры структурирования проектов приведены в примерах внедрения.

 <a name="Adding_Files" />


## <a name="adding-files"></a>Добавление файлов

 <a name="Build_Action" />


### <a name="build-action"></a>Действие при сборке

Важно правильно задать действие сборки для определенных типов файлов. В этом списке показано действие сборки для некоторых распространенных типов файлов:

- **Все C# файлы** — действие сборки: Компилятор
- **Изображения в Xamarin. iOS & Windows** — действие сборки: Content
- **XIB и файлы раскадровки в Xamarin. iOS** — действие сборки: интерфацедефинитион
- **Изображения и макеты AXML в Android** — действие сборки: AndroidResource
- **XAML-файлы в проектах Windows** — действие сборки: Страница
- **Файлы XAML Xamarin. Forms** — действие сборки: ВнедренныйРесурс


Как правило, интегрированная среда разработки определит тип файла и предложит правильное действие сборки.

 <a name="Case_Sensitivity" />


### <a name="case-sensitivity"></a>Учет регистра

Наконец, помните, что некоторые платформы имеют файловые системы с учетом регистра (например,
iOS и Android), поэтому обязательно используйте согласованный стандарт именования файлов и убедитесь, что имена файлов, используемые в коде, точно соответствуют файловой системе. Это особенно важно для изображений и других ресурсов, на которые вы ссылаетесь в коде.
