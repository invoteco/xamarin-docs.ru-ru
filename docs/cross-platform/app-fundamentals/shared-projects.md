---
title: Использование общих проектов для совместного использования кода
description: Общие проекты позволяют писать общий код, на который ссылается несколько различных проектов приложений. Код компилируется как часть каждого ссылающегося проекта и может включать директивы компилятора, которые помогают внедрить функции конкретной платформы в общую базу кода.
ms.prod: xamarin
ms.assetid: 191c71fb-44a4-4e6c-af4b-7b1107dce6af
author: conceptdev
ms.author: crdun
ms.date: 07/18/2018
ms.openlocfilehash: ed58b0810d3c4fd3a3dd99cddd16227f9ac30273
ms.sourcegitcommit: 9bfedf07940dad7270db86767eb2cc4007f2a59f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/21/2019
ms.locfileid: "68739059"
---
# <a name="shared-projects-code-sharing"></a>Совместное использование общего кода проектов

_Общие проекты позволяют писать общий код, на который ссылается несколько различных проектов приложений. Код компилируется как часть каждого ссылающегося проекта и может включать директивы компилятора, которые помогают внедрить функции, зависящие от платформы, в общую базу кода._

Общие проекты (иногда называемые также проектами общих ресурсов) позволяют создавать код, который является общим для нескольких целевых проектов, включая приложения Xamarin.

Они поддерживают директивы компилятора, чтобы можно было условно включить код, зависящий от платформы, для компиляции в подмножество проектов, ссылающихся на общий проект. Также поддерживается интегрированная среда разработки, помогающая управлять директивами компилятора и визуализировать, как код будет выглядеть в каждом приложении.

Если вы использовали компоновку файлов в прошлом для обмена кодом между проектами, то общие проекты работают аналогичным образом, но с значительно улучшенной поддержкой интегрированной среды разработки.

## <a name="what-is-a-shared-project"></a>Что такое общий проект?

В отличие от большинства других типов проектов, общий проект не имеет выходных данных (в виде библиотеки DLL), а код компилируется в каждый проект, который ссылается на него. Это показано на схеме ниже — по сути, все содержимое общего проекта «копируется в» каждый проект ссылки и компилируется, как будто оно является частью.

![](shared-projects-images/sharedassetproject.png "Shared Project architecture")

Код в общем проекте может содержать директивы компилятора, которые будут включать или отключать разделы кода в зависимости от того, какой проект приложения использует код, который предлагается в цветовых полях платформы на схеме.

Общий проект не компилируется самостоятельно, он существует исключительно как группирование файлов исходного кода, которые могут быть включены в другие проекты. При ссылке на другой проект код фактически компилируется как *часть* этого проекта. Общие проекты не могут ссылаться на другие типы проектов (включая другие общие проекты).

Обратите внимание, что проекты приложений Android не могут ссылаться на другие проекты приложений Android. Например, проект модульного теста Android не может ссылаться на проект приложения Android. Дополнительные сведения об этом ограничении см. в этом [обсуждении форума](http://forums.xamarin.com/discussion/comment/98092/).

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

## <a name="visual-studio-for-mac-walkthrough"></a>Пошаговое руководство по Visual Studio для Mac

В этом разделе описывается создание и использование общего проекта с помощью Visual Studio для Mac. Полный пример см. в разделе [Пример общего проекта](#Shared_Project_Example) .

## <a name="creating-a-shared-project"></a>Создание общего проекта

Чтобы создать новый общий проект, перейдите в **файл > создать решение...** (или щелкните правой кнопкой мыши существующее решение и выберите **Добавить > добавить новый проект...** ):

[![Новый общий проект](shared-projects-images/xs-newsolution-sml.png "Новое решение")](shared-projects-images/xs-newsolution.png#lightbox)

На следующем экране выберите имя проекта и нажмите кнопку **создать**.

Новый общий проект показан ниже — Обратите внимание, что отсутствуют ссылки или узлы компонентов. они не поддерживаются для общих проектов.

![Пустой общий проект](shared-projects-images/xs-empty.png "Пустой общий проект")

Чтобы общий проект был полезен, на него должен быть указан хотя бы один проект, поддерживающий сборку (например, приложение или библиотека iOS или Android или проект PCL). Общий проект не компилируется, если он не ссылается на него, поэтому ошибки синтаксиса (или любые другие) не будут выделяться, пока на него не будет ссылка.

Добавление ссылки на общий проект выполняется таким же образом, как и ссылка на обычный проект библиотеки. На этом снимке экрана показан проект Xamarin. iOS, ссылающийся на общий проект.

![](shared-projects-images/xs-reference.png "Project reference to Shared Project")

После того как на общий проект ссылается другая библиотека или приложение, можно создать решение и просмотреть все ошибки в коде. Если на общий проект ссылаются _два или более_ других проекта, в левом верхнем углу редактора исходного кода появится меню, показывающее, какие проекты ссылаются на этот файл.

## <a name="shared-project-options"></a>Параметры общего проекта

Если щелкнуть правой кнопкой мыши общий проект и выбрать **Параметры** , количество параметров в нем меньше, чем у других типов проектов. Поскольку общие проекты не компилируются (самостоятельно), нельзя задавать выходные или параметры компилятора, конфигурации проектов, подписывания сборок или пользовательские команды. Код в общем проекте фактически наследует эти значения от любых ссылок на них.

Экран **Параметры** показан ниже: **имя** проекта и **пространство имен по умолчанию** являются единственными двумя параметрами, которые обычно меняются.

![](shared-projects-images/xs-sharedprojectoptions.png "Shared Project Options")

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

## <a name="visual-studio-walkthrough"></a>Пошаговое руководство по Visual Studio

В этом разделе описывается создание и использование общего проекта с помощью Visual Studio. Полную реализацию см. в разделе [Пример общего проекта](#Shared_Project_Example) .

### <a name="creating-a-shared-project"></a>Создание общего проекта

Чтобы создать новый общий проект, перейдите в **файл**  > **Новый**  > **проект**.

В Visual Studio 2019 введите **Shared** в поле поиска на странице **Создание нового проекта** . Выберите шаблон **общего проекта** и нажмите кнопку **Далее**. Введите имя проекта и нажмите кнопку **создать**.

В Visual Studio 2017 выберите шаблон **общего проекта** , а затем выберите имя проекта.

![Шаблон общего проекта в Visual Studio 2017](shared-projects-images/vs-newsolution.png)

Можно также добавить новый общий проект в существующее решение, щелкнув файл решения правой кнопкой мыши и выбрав **добавить > новый проект**. Новый общий проект выглядит, как показано ниже (после добавления файла класса). Обратите внимание, что ссылки или узлы компонентов отсутствуют. они не поддерживаются для общих проектов.

![](shared-projects-images/vs-empty.png "Empty Shared Project")

Чтобы общий проект был полезен, на него должен быть указан хотя бы один проект, поддерживающий сборку (например, приложение или библиотека iOS или Android или проект PCL). Общий проект не компилируется, если он не ссылается на него, поэтому ошибки синтаксиса (или любые другие) не будут выделяться, пока на него не будет ссылка.

Добавление ссылки на общий проект выполняется таким же образом, как и ссылка на обычный проект библиотеки. На этом снимке экрана показан проект Xamarin. iOS, ссылающийся на общий проект.

![](shared-projects-images/vs-reference.png "Project reference to Shared Project")

После того как на общий проект ссылается другая библиотека или приложение, можно создать решение и просмотреть все ошибки в коде. Если на общий проект ссылаются _два или более_ других проекта, в левом верхнем углу редактора исходного кода появится меню, чтобы увидеть, какие проекты ссылаются на текущий файл кода.

### <a name="shared-project-properties"></a>Свойства общего проекта

При выборе общего проекта в панели свойств будет меньше параметров, чем для других типов проектов. Поскольку общие проекты не компилируются (самостоятельно), нельзя задавать выходные или параметры компилятора, конфигурации проектов, подписывания сборок или пользовательские команды. Код в общем проекте фактически наследует эти значения от любых ссылок на них.

Ниже показана панель **Свойства** . **корневое пространство имен** — это единственный параметр, который можно изменить.

![](shared-projects-images/vs-sharedprojectproperties.png "Shared Project Properties")

-----

<a name="Shared_Project_Example"/>

## <a name="shared-project-example"></a>Пример общего проекта

В примере [задачи](https://github.com/xamarin/mobile-samples/tree/master/Tasky) используется общий проект для хранения общего кода, используемого как приложениями iOS, Android, так и Windows Phone. Файлы исходного кода `SQLite.cs` и `TaskRepository.cs` задают директивы компилятора (например, `#if __ANDROID__`) для получения различных выходных данных для каждого из приложений, ссылающихся на них.

Полная структура решения показана ниже (в Visual Studio для Mac и Visual Studio соответственно):

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

![](shared-projects-images/xs-examplesolution.png "Visual Studio for Mac solution")

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

![](shared-projects-images/vs-examplesolution.png "Visual Studio solution")

-----

Windows Phone проект можно перемещать из Visual Studio для Mac, хотя этот тип проекта не поддерживается для компиляции в Visual Studio для Mac.

Ниже показаны выполняющиеся приложения.

![](shared-projects-images/example.png "iOS, Android, Windows Phone examples")

## <a name="summary"></a>Сводка

В этом документе описано, как работают общие проекты, как их можно создавать и использовать в Visual Studio для Mac и Visual Studio, а также представлен простой пример приложения, демонстрирующий общий проект в действии.

## <a name="related-links"></a>Связанные ссылки

- [Пример приложения для задач](https://github.com/xamarin/mobile-samples/tree/master/Tasky)
- [Переносимые библиотеки классов (пример)](~/cross-platform/app-fundamentals/pcl.md)
- [Параметры общего доступа к коду (пример)](~/cross-platform/app-fundamentals/code-sharing.md)
