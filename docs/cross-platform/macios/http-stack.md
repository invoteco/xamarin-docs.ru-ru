---
title: Селектор реализации HttpClient и SSL/TLS для iOS/macOS
description: В HttpClient стека и реализации SSL/TLS определяется реализация HttpClient и SSL/TLS, которая будет использоваться приложением Xamarin iOS, tvOS или macOS.
ms.prod: xamarin
ms.assetid: 12101297-BB04-4410-85F0-A0D41B7E6591
author: conceptdev
ms.author: crdun
ms.date: 04/20/2018
ms.openlocfilehash: f3c30e8edc36c6d92b6fac0bd0e199aa26e16993
ms.sourcegitcommit: 933de144d1fbe7d412e49b743839cae4bfcac439
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/04/2019
ms.locfileid: "70280926"
---
# <a name="httpclient-and-ssltls-implementation-selector-for-iosmacos"></a>Селектор реализации HttpClient и SSL/TLS для iOS/macOS

**Селектор реализации HttpClient** для Xamarin. iOS, Xamarin. tvOS и Xamarin. Mac определяет, какую `HttpClient` реализацию использовать. Можно переключиться на реализацию, которая использует собственные транспорты iOS, tvOS или macOS (`NSUrlSession` или `CFNetwork`, в зависимости от ОС). Перевернутая служба поддерживает TLS 1,2, меньше двоичных файлов и ускоряет загрузку; недостаток заключается в том, что для выполнения асинхронных операций требуется выполнение цикла событий.

Проекты должны ссылаться на сборку **System .NET. http** .

> [!WARNING]
> **Апрель 2018** — из-за повышенных требований к безопасности, включая соответствие требованиям PCI, основным поставщикам облачных услуг и веб-серверам требуется отключить поддержку протоколов TLS версий старше 1,2. Проекты Xamarin, созданные в предыдущих версиях Visual Studio по умолчанию, используют более старые версии TLS.
>
> Чтобы ваши приложения продолжали работать с этими серверами и службами, необходимо **обновить проекты `NSUrlSession` Xamarin с помощью параметра, показанного ниже, а затем повторно создать и повторно развернуть приложения** для пользователей.

### <a name="selecting-an-httpclient-stack"></a>Выбор стека HttpClient

Чтобы настроить `HttpClient` используемое приложение, сделайте следующее:

1. Дважды щелкните **имя проекта** в **Обозреватель решений** , чтобы открыть параметры проекта.
2. Переключитесь на параметры **сборки** для своего проекта (например, **сборку iOS** для приложения Xamarin. IOS).
3. В раскрывающемся списке **Реализация HttpClient** выберите `HttpClient` тип одним из следующих: **NSUrlSession** (рекомендуется), **CFNetwork**или **Managed**.

[![Выбор реализации HttpClient из управляемых, CFNetwork или NSUrlSession](http-stack-images/http-xs-sml.png)](http-stack-images/http-xs.png#lightbox)

> [!TIP]
> Для протокола TLS 1,2 `NSUrlSession` рекомендуется использовать параметр.

### <a name="nsurlsession"></a>NSUrlSession

Обработчик на основе основан на собственной `NSURLSession` платформе, доступной в iOS 7 и более поздних версиях. `NSURLSession` 
**Это рекомендуемый параметр.**

#### <a name="pros"></a>ИТ специалистов

- Он использует собственные API для повышения производительности и меньшего размера исполняемого файла.
- Поддержка новейших стандартов, таких как TLS 1,2.

#### <a name="cons"></a>Недостатки

- Требуется iOS 7 или более поздней версии.
- Некоторые `HttpClient` функции и параметры недоступны.

### <a name="cfnetwork"></a>CFNetwork

Обработчик на основе основан на собственной `CFNetwork` платформе, доступной в iOS 6 и более поздних версиях. `CFNetwork`

#### <a name="pros"></a>ИТ специалистов

- Он использует собственные API для повышения производительности и меньшего размера исполняемого файла.
- Поддержка более новых стандартов, таких как TLS 1,2.

#### <a name="cons"></a>Недостатки

- Требуется iOS 6 или более поздней версии.
- Недоступно в watchOS.
- Некоторые функции и параметры HttpClient недоступны.

### <a name="managed"></a>Управляется

Управляемый обработчик — это полностью управляемый обработчик HttpClient, который поставлялся с предыдущей версией Xamarin.

#### <a name="pros"></a>ИТ специалистов

- Он имеет наиболее совместимый набор функций с Microsoft .NET и более старыми версиями Xamarin.

#### <a name="cons"></a>Недостатки

- Она не полностью интегрирована с ОС Apple и ограничена TLS 1,0. В будущем, возможно, не удастся подключиться к безопасным веб-серверам или облачным службам.
- Обычно это выполняется намного медленнее, чем при шифровании машинных интерфейсов API.
- Для этого требуется более управляемый код, что позволяет создать более крупный распространяемый пакет приложения.

### <a name="programmatically-setting-the-httpmessagehandler"></a>Программная установка HttpMessageHandler

В дополнение к конфигурации на уровне проекта, показанной выше, можно также создать экземпляр `HttpClient` и внедрить требуемый `HttpMessageHandler` объект с помощью конструктора, как показано в следующих фрагментах кода:

```csharp
// This will use the default message handler for the application; as
// set in the Project Options for the project.
HttpClient client = new HttpClient();

// This will create an HttpClient that explicitly uses the CFNetworkHandler
HttpClient client = new HttpClient(new CFNetworkHandler());

// This will create an HttpClient that explicitly uses NSUrlSessionHandler
HttpClient client = new HttpClient(new NSUrlSessionHandler());
```

Это позволяет использовать отличия `HttpMessageHandler` от того, что объявлено в диалоговом окне " **Параметры проекта** ".

## <a name="ssltls-implementation"></a>Реализация SSL/TLS

SSL (уровень SSL) и его последователем, TLS (безопасность транспортного уровня) обеспечивают поддержку HTTP и других сетевых подключений через `System.Net.Security.SslStream`. В `System.Net.Security.SslStream` реализации Xamarin. iOS, Xamarin. tvOS или Xamarin. Mac будет вызываться собственная реализация по протоколу SSL/TLS вместо использования управляемой реализации, предоставляемой Mono. Собственная реализация Apple поддерживает TLS 1,2.

> [!WARNING]
> Будущий выпуск Xamarin.Mac 4.8 будет поддерживать только macOS 10.9 или более поздней версии.
> Предыдущие версии Xamarin.Mac поддерживали macOS 10.7 или более поздней версии, но в этих версиях macOS нет достаточной инфраструктуры TLS для поддержки TLS 1.2. Для macOS 10.7 или macOS 10.8 используйте Xamarin.Mac 4.6 или более ранней версии.

## <a name="app-transport-security"></a>Защита транспорта приложения

_Защита транспорта приложений_ Apple (ATS) обеспечивает безопасные подключения между Интернет-ресурсами (например, серверным сервером приложения) и приложением. ATS гарантирует, что все Интернет-подключения должны быть согласованы с рекомендациями по обеспечению безопасности подключений, тем самым предотвращая случайное раскрытие конфиденциальной информации напрямую через приложение или библиотеку, которую он использует.

Так как ATS включен по умолчанию в приложениях, созданных для iOS 9, tvOS 9 и OS X 10,11 (El Capitan) и более поздних `NSUrlConnection`версий `CFUrl` , `NSUrlSession` все соединения, использующие или, будут подвержены требованиям безопасности ATS. Если подключения не соответствуют этим требованиям, они завершатся сбоем с исключением.

В зависимости от параметров стека HttpClient и реализации SSL/TLS, возможно, потребуется внести изменения в приложение для правильной работы с ATS.

Чтобы узнать больше о ATS, ознакомьтесь с нашим [руководством по безопасности транспорта приложений](~/ios/app-fundamentals/ats.md).

## <a name="known-issues"></a>Известные проблемы

В этом разделе рассматриваются известные проблемы, связанные с поддержкой TLS в Xamarin. iOS.

### <a name="project-failed-to-load-with-error-requested-value-appletls-wasnt-found"></a>Не удалось загрузить проект, ошибка "запрошенное значение Апплетлс не найдено"

В Xamarin. iOS 9,8 появились новые параметры, содержащие **CSPROJ** -файл для приложения Xamarin. iOS. Эти изменения могут вызвать проблемы при открытии проекта с более старыми версиями Xamarin. iOS. На следующем снимке экрана показан пример сообщения об ошибке, которое может отображаться в этом сценарии:

![Снимок экрана ошибки при попытке загрузить проект, запрошенное значение Legacy не найдено](http-stack-images/tlserror-xs.png)

Эта ошибка вызвана введением `MtouchTlsProvider` параметра в файл проекта в Xamarin. iOS 9,8. Если обновление до Xamarin. iOS 9,8 (или более поздней версии) невозможно, то обходным путем можно вручную изменить приложение с расширением **CSPROJ** , удалить `MtouchTlsprovider` элемент, а затем сохранить измененный файл проекта.

В следующем фрагменте кода приведен пример того, `MtouchTlsProvider` как может выглядеть параметр в **CSPROJ** -файле:

```xml
<MtouchTlsProvider>Default</MtouchTlsProvider>
```

## <a name="related-links"></a>Связанные ссылки

- [Протокол TLS](~/cross-platform/app-fundamentals/transport-layer-security.md)
- [Безопасность транспорта приложения](~/ios/app-fundamentals/ats.md)
