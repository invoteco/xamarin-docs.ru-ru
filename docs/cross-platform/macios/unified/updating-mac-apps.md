---
title: Обновление существующих приложений Mac
description: В этом документе описаны действия, которые необходимо выполнить для обновления приложения Xamarin. Mac с Classic API на Unified API.
ms.prod: xamarin
ms.assetid: 26673CC5-C1E5-4BAC-BEF4-9A386B296FD5
author: davidortinau
ms.author: daortin
ms.date: 03/29/2017
ms.openlocfilehash: 4590e5d987acbb5bd97b41477e6aafa7c17d7778
ms.sourcegitcommit: 2fbe4932a319af4ebc829f65eb1fb1816ba305d3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2019
ms.locfileid: "73015317"
---
# <a name="updating-existing-mac-apps"></a>Обновление существующих приложений Mac

Обновление существующего приложения для использования Unified API требует внесения изменений в сам файл проекта, а также пространств имен и интерфейсов API, используемых в коде приложения.

## <a name="the-road-to-64-bits"></a>Путь к 64 бит

Новые унифицированные API-интерфейсы необходимы для поддержки архитектуры 64-разрядного устройства из приложения Xamarin. Mac. По состоянию на 1 февраля 2015 компании Apple требуется, чтобы все новые отправки приложений в Mac App Store поддерживали 64-разрядные архитектуры.

Xamarin предоставляет инструментарий для Visual Studio для Mac и Visual Studio, чтобы автоматизировать процесс миграции с Classic API на Unified API или преобразовать файлы проекта вручную. Хотя использование автоматического инструментария очень рекомендовано, в этой статье рассматриваются оба метода.

### <a name="before-you-start"></a>Перед началом работы...

Перед обновлением существующего кода до Unified API настоятельно рекомендуется устранить все *предупреждения компиляции*. Многие *предупреждения* в Classic API станут такими ошибками после миграции в единую систему. Устранение ошибок перед началом работы упрощается, поскольку сообщения компилятора из Classic API часто содержат указания по обновлению.

## <a name="automated-updating"></a>Автоматическое обновление

После устранения предупреждений выберите существующий проект Mac в Visual Studio для Mac или Visual Studio и выберите **перенести в Xamarin. Mac Unified API** из меню **проект** . Пример:

![](updating-mac-apps-images/beta-tool1.png "Choose Migrate to Xamarin.Mac Unified API from the Project menu")

Перед выполнением автоматизированной миграции необходимо согласиться с этим предупреждением (очевидно, что перед начинать в этом Adventure необходимо убедиться в наличии резервных копий и системы управления версиями):

![](updating-mac-apps-images/migrate01.png "Agree to this warning before the automated migration will run")

Существует два поддерживаемых типа целевой платформы, которые можно выбрать при использовании Unified API в приложении Xamarin. Mac:

- **Xamarin. Mac Mobile Framework** — это та же настроенная платформа .NET Framework, которая используется Xamarin. iOS и Xamarin. Android, поддерживающая подмножество всей **рабочей** среды. Это рекомендуемая платформа, так как она предоставляет небольшие двоичные файлы меньшего размера из-за высокого поведения компоновки.
- **.Net 4,5 Framework Xamarin. Mac** — эта платформа снова является подмножеством **настольной** платформы. Тем не менее, она обрезает гораздо меньше от всей платформы для **настольных компьютеров** , чем **Мобильная** платформа, и должна _«просто работать»_ с большинством пакетов NuGet или сторонних библиотек. Это позволяет разработчику использовать стандартные сборки для **настольных систем** , продолжая использовать поддерживаемую платформу, но этот параметр создает большие наборы приложений. Это рекомендуемая платформа, в которой используются сторонние сборки .NET, несовместимые с **платформой Xamarin. Mac Mobile**. Список поддерживаемых сборок см. в документации по нашим [сборкам](~/cross-platform/internals/available-assemblies.md) .

Подробные сведения о целевых платформах и последствиях выбора конкретного целевого объекта для приложения Xamarin. Mac см. в документации по [целевым платформам](~/mac/platform/target-framework.md) . 

Это средство, по сути, автоматизирует все шаги, описанные в разделе **обновление вручную** , и является предлагаемым способом преобразования существующего проекта Xamarin. Mac в Unified API.

## <a name="steps-to-update-manually"></a>Действия по обновлению вручную

После исправления предупреждений выполните следующие действия, чтобы вручную обновить приложения Xamarin. Mac для использования нового Unified API:

### <a name="1-update-project-type--build-target"></a>1. Обновление типа проекта & целевой объект сборки

Измените версию проекта в файлах **CSPROJ** с `42C0BBD9-55CE-4FC1-8D90-A7348ABAFB23` на `A3F8F2AB-B479-4A4A-A458-A89E7DC349F1`. Измените файл **CSPROJ** в текстовом редакторе, заменив первый элемент в элементе `<ProjectTypeGuids>`, как показано ниже:

![](updating-mac-apps-images/csproj.png "Edit the csproj file in a text editor, replacing the first item in the ProjectTypeGuids element as shown")

Измените элемент **Import** , содержащий `Xamarin.Mac.targets`, на `Xamarin.Mac.CSharp.targets`, как показано ниже.

![](updating-mac-apps-images/csproj2.png "Change the Import element that contains Xamarin.Mac.targets to Xamarin.Mac.CSharp.targets as shown")

Добавьте следующие строки кода после элемента `<AssemblyName>`:

```xml
<TargetFrameworkVersion>v2.0</TargetFrameworkVersion>
<TargetFrameworkIdentifier>Xamarin.Mac</TargetFrameworkIdentifier>

```

Пример

![Добавьте следующие строки кода после элемента \<AssemblyName >](updating-mac-apps-images/csproj3.png)

### <a name="2-update-project-references"></a>2. Обновление ссылок проекта

Разверните узел " **ссылки** " проекта приложения Mac. Вначале будет показана * Неработающая ссылка на **ксаммак** , как на этом снимке экрана (так как мы только что изменили тип проекта):

![](updating-mac-apps-images/references.png "It will initially show a broken- XamMac reference similar to this screenshot")

Щелкните **значок шестеренки** рядом с записью **Ксаммак** и выберите **Удалить** , чтобы удалить неработающую ссылку.

Затем щелкните правой кнопкой мыши папку **References** в **Обозреватель решений** и выберите **изменить ссылки**. Прокрутите список ссылок до конца списка и поместите флажок, помимо **Xamarin. Mac**.

![](updating-mac-apps-images/references2.png "Scroll to the bottom of the list of references and place a check besides Xamarin.Mac")

Нажмите кнопку **ОК** , чтобы сохранить изменения ссылок на проект.

### <a name="3-remove-monomac-from-namespaces"></a>3. Удаление MonoMac из пространств имен

Удалите префикс **MonoMac** из пространств имен в инструкциях `using` или в любом месте полного имени класса ClassName (например, `MonoMac.AppKit` просто `AppKit`).

### <a name="4-remap-types"></a>4. Сопоставление типов

Были введены [собственные типы](~/cross-platform/macios/nativetypes.md) , которые заменяют некоторые ранее использовавшиеся типы, например экземпляры `System.Drawing.RectangleF` с `CoreGraphics.CGRect` (например,). Полный список типов можно найти на странице " [собственные типы](~/cross-platform/macios/nativetypes.md) ".

### <a name="5-fix-method-overrides"></a>5. Исправление переопределений методов

Для некоторых `AppKit` методов была изменена сигнатура для использования новых [собственных типов](~/cross-platform/macios/nativetypes.md) (например, `nint`). Если пользовательские подклассы переопределяют эти методы, сигнатуры больше не будут совпадать и будут приводить к ошибкам. Исправьте эти переопределения метода, изменив подкласс в соответствии с новой сигнатурой, используя собственные типы. 

## <a name="considerations"></a>Особенности

При преобразовании существующего проекта Xamarin. Mac из Classic API в новый Unified API необходимо учитывать следующие моменты, если это приложение полагается на один или несколько компонентов или пакетов NuGet. 

### <a name="components"></a>Компоненты

Любой компонент, который вы включили в приложение, также потребуется обновить до Unified API или при попытке компиляции возникнет конфликт. Для любого включаемого компонента замените текущую версию новой версией из хранилища компонентов Xamarin, которое поддерживает Unified API и выполните чистую сборку. Все компоненты, которые еще не были преобразованы автором, будут отображать предупреждение только 32 бит в хранилище компонентов.

### <a name="nuget-support"></a>Поддержка NuGet

Хотя мы внесены изменения в NuGet для работы со службой поддержки Unified API, новый выпуск NuGet не был новым, поэтому мы рассказывающие, как получить NuGet для распознавания новых интерфейсов API. 

До этого времени, как и для компонентов, необходимо переключить любой пакет NuGet, который вы включили в проект, в версию, поддерживающую унифицированные интерфейсы API, и затем выполнить чистую сборку.

> [!IMPORTANT]
> Если имеется ошибка в форме _"Ошибка 3 не может содержать" monomac. dll "и" Xamarin. Mac. dll "в одном проекте Xamarin. Mac —" Xamarin. Mac. dll "ссылается явно, а" monomac. dll "ссылается на" XXX, Version = 0.0.000, Culture = Neutral, PublicKeyToken = null ""_ после преобразования приложения в унифицированные API, как правило, это происходит из-за наличия в проекте компонента или пакета NuGet, который не был обновлен до Unified API. Необходимо удалить существующий компонент или NuGet, обновить версию, поддерживающую унифицированные API-интерфейсы, и выполнить чистую сборку.

## <a name="enabling-64-bit-builds-of-xamarinmac-apps"></a>Включение 64 разрядных сборок приложений Xamarin. Mac

Для мобильного приложения Xamarin. Mac, которое было преобразовано в Unified API, разработчику по-прежнему необходимо включить сборку приложения на 64 разрядных компьютеров с помощью параметров приложения. Подробные инструкции по 64 включению поразрядных сборок см. в статье **включение 64-разрядных сборок приложений Xamarin. Mac** из раздела [32/64 разрядов платформы](~/cross-platform/macios/32-and-64/index.md) .

## <a name="finishing-up"></a>Завершение

Если вы решили использовать автоматический или ручной метод преобразования приложения Xamarin. Mac из классической среды в унифицированные API, существует несколько экземпляров, требующих дальнейших действий, которые потребуется выполнить вручную. Ознакомьтесь с нашими [советами по обновлению кода в Unified API](~/cross-platform/macios/unified/updating-tips.md) документе для получения известных проблем и устранения неполадок.

## <a name="related-links"></a>Связанные ссылки

- [Советы по обновлению кода в Unified API](~/cross-platform/macios/unified/updating-tips.md)
- [Работа с собственными типами в кроссплатформенных приложениях](~/cross-platform/macios/native-types-cross-platform.md)
- [Различия между классическими и Unified APIми](https://github.com/xamarin/release-notes-archive/blob/master/release-notes/ios/api_changes/classic-vs-unified-8.6.0/index.md)
