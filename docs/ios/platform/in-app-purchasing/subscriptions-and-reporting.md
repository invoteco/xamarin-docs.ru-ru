---
title: Подписки и отчеты в Xamarin. iOS
description: В этом документе описываются необновляемые подписки, Бесплатные подписки, устанавливать возобновляемую подписки и использование iTunes Connect для отчета об этих элементах.
ms.prod: xamarin
ms.assetid: 27EE4234-07F5-D2CD-DC1C-86E27C20141E
ms.technology: xamarin-ios
author: davidortinau
ms.author: daortin
ms.date: 03/18/2017
ms.openlocfilehash: 5e1019417ff7ac93abfe2396a4acaa76c66d182f
ms.sourcegitcommit: db422e33438f1b5c55852e6942c3d1d75dc025c4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2020
ms.locfileid: "76725372"
---
# <a name="subscriptions-and-reporting-in-xamarinios"></a>Подписки и отчеты в Xamarin. iOS

## <a name="about-non-renewing-subscriptions"></a>О подписках, которые не возобновляются

Необновляемые подписки предназначены для продуктов, которые представляют продажу службы с ограничением по времени (например, доступ на одну неделю к приложению навигации или доступ к архиву данных ограничен по времени).   

Основные различия между необновляемыми подписками и другими типами продуктов:

- Определение продукта в iTunes Connect не включает термин. Код приложения должен иметь возможность определить срок действия по ИДЕНТИФИКАТОРу продукта.
- Их можно приобрести несколько раз (например, в потребленном продукте). Приложения необходимы для управления термином и сроком действия подписки, а также для предотвращения приобретения перекрывающихся подписок.
- Покупки не поддерживаются функцией StoreKit Restore. Если подписка должна быть доступна на всех устройствах пользователя, приложению потребуется разработать и реализовать эту функцию в сочетании с удаленным сервером. Приложения также отвечают за резервное копирование состояния подписки для случаев, когда выполняется резервное копирование устройства и восстановление из резервной копии.
- Обзор реализации
- Обычно подписки, которые не обновляются, должны быть реализованы с помощью рабочего процесса, предоставляемого сервером, и управляемых, например потребляемых продуктов.

## <a name="about-free-subscriptions"></a>О бесплатных подписках

Бесплатные подписки позволяют разработчикам размещать бесплатное содержимое в приложениях киоска (их нельзя использовать в приложениях, не являющихся киоска). После запуска бесплатной подписки она будет доступна на всех устройствах пользователей. Срок действия бесплатных подписок никогда не истекает; они заканчиваются только при удалении приложения.

### <a name="implementation-overview"></a>Обзор реализации

Бесплатные подписки ведут себя так же, как и устанавливать возобновляемуюные подписки. У приложения должен быть бесплатный продукт подписки, доступный для приобретения в iTunes Connect. При приобретении у пользователя бесплатная подписка должна быть проверена как продукт с автоматической устанавливать возобновляемуюой подпиской. Можно восстановить бесплатные транзакции подписки.

## <a name="about-auto-renewable-subscriptions"></a>О подписках с Auto-устанавливать возобновляемую

Подписки Auto-устанавливать возобновляемую в основном используются в приложениях киоска. Они представляют продукт, который предоставляет пользователю доступ к динамическому содержимому в течение заданного периода времени, настроенного в iTunes Connect (задайте периоды в диапазоне от 7 дней до 1 года). Подписки обновляются автоматически, заряжается идентификатор Apple ID в конце каждого периода подписки, если пользователь не выйдет из использования. Этот тип продукта хорошо подходит для подписок журналов и новостей, где пользователь получает доступ к каждой опубликованной публикации, пока их подписка действительна.

### <a name="implementation-overview"></a>Обзор реализации

Подписки Auto-устанавливать возобновляемую должны быть реализованы с помощью рабочего процесса серверных продуктов (см. раздел *Проверка поступления и серверные продукты* ).

#### <a name="shared-secret"></a>Общий секрет

Общий секрет покупки в приложении должен использоваться в запросе JSON при проверке подписок Auto-устанавливать возобновляемую на сервере. Общий секрет создается для доступа через iTunes Connect.

На домашней странице iTunes Connect выберите **Мои приложения**:   

 [![](subscriptions-and-reporting-images/image2.png "Select My Apps")](subscriptions-and-reporting-images/image2.png#lightbox)  

Выберите приложение и щелкните вкладку **покупки в приложении** :

[![](subscriptions-and-reporting-images/image6.png "Click on the In-App Purchases tab")](subscriptions-and-reporting-images/image6.png#lightbox)

В нижней части страницы выберите **Просмотреть или создать общий секрет**:

 [![](subscriptions-and-reporting-images/image40.png "Select View or generate a shared secret")](subscriptions-and-reporting-images/image40.png#lightbox)

 [![](subscriptions-and-reporting-images/image41.png "Generate a shared secret")](subscriptions-and-reporting-images/image41.png#lightbox)   

Чтобы использовать общий секрет, включите его в полезные данные JSON, которые отправляются на серверы Apple при проверке уведомления о покупке в приложении для автоматической подписки устанавливать возобновляемую, например:

```csharp
{
   "receipt-data" : "(receipt bytes here)",
   "password"     : "(shared secret bytes here)"
}
```

Если покупка допустима, то, как и для других типов продуктов, поле состояния ответа будет равно нулю.

#### <a name="downloading-items-after-the-initial-subscription-term"></a>Загрузка элементов после первоначального срока подписки

В рамках доставки продуктов для подписки код должен часто проверять Последний известный приход на серверах Apple. Если после последней проверки подписка была успешно продлена, ответ JSON будет содержать дополнительные поля, уведомляющие приложение о произошедшей транзакции (которая должна продлить срок действия подписок). Ответ JSON будет содержать:

```csharp
{
   "status" : 0,
   "receipt" : { (receipt here) },
   "latest_receipt" : "(base-64 encoded receipt here)",
   "latest_receipt_info" : { (latest receipt info here) }
}
```

Если состояние равно нулю, подписка все еще действительна, а другие поля содержат допустимые данные. Если состояние — 21006, срок действия подписки истек. Другие коды ошибок см. в документации по [проверке подлинности устанавливать возобновляемую по подписке](https://developer.apple.com/library/ios/releasenotes/General/ValidateAppStoreReceipt/Chapters/ValidateRemotely.html) .

#### <a name="restoring-auto-renewable-subscriptions"></a>Восстановление подписок Auto-устанавливать возобновляемую

Вы получите несколько транзакций — исходная транзакция покупки и отдельная транзакция за каждый период времени, когда подписка была продлена. Необходимо отвести отслеживание дат и условий начала, чтобы понять, что такое период действия.   

Объект Скпайменттрансактион не включает термин подписки. для каждого термина следует использовать другой идентификатор продукта и написать код, который может вычислить период подписки с даты покупки транзакции.

#### <a name="testing-auto-renewal"></a>Тестирование автоматического продления

Чтобы упростить тестирование подписок, их длительность сжимается при тестировании в песочнице. подписки на 1 неделю обновляются каждые 3 минуты, а подписки с 1 годом обновляются каждый час. Подписки будут обновляться не более 6 раз при тестировании в песочнице.

## <a name="reporting"></a>Reporting

iTunes Connect ( [iTunesConnect.Apple.com](https://itunesconnect.apple.com)) предоставляет:   

 **Продажи и тенденции** — отображает сведения о загрузке приложений, обновлениях и покупках в приложениях.   

 **Платежи и финансовые отчеты** — сведения о доходах, полученных вашими приложениями, а также список платежей, которые были сделаны вам, и количество задолженностей.

Ниже приведен пример отчета о продажах и тенденциях.   

 [![](subscriptions-and-reporting-images/image42.png "An example Sales and Trends report")](subscriptions-and-reporting-images/image42.png#lightbox)   

 Существует также приложение **ИТК Connect Mobile** iOS. ниже показаны снимки экрана iPhone для некоторых доступных статистических данных.   

 [![](subscriptions-and-reporting-images/image43.png "iPhone screenshots for some of the statistics available")](subscriptions-and-reporting-images/image43.png#lightbox)
