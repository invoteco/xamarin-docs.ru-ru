---
title: Улучшения поиска и мини-приложений начального экрана в iOS 10
description: В этом документе описываются улучшения, внесенные компанией Apple для мини-приложений в iOS 10, включая обновления для панели поиска и мини-приложений начального экрана.
ms.prod: xamarin
ms.assetid: D66FD9E1-9E23-4BB6-825C-ED19B8F72A81
ms.technology: xamarin-ios
author: lobrien
ms.author: laobri
ms.date: 03/17/2017
ms.openlocfilehash: 71c58baee5e98efcfb38b75ffed2b85c90f8a131
ms.sourcegitcommit: c9651cad80c2865bc628349d30e82721c01ddb4a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/03/2019
ms.locfileid: "70227362"
---
# <a name="search-and-home-screen-widget-enhancements-in-ios-10"></a>Улучшения поиска и мини-приложений начального экрана в iOS 10

_В этой статье рассматриваются улучшения, внесенные компанией Apple в систему мини-приложений в iOS 10._

Компания Apple представила несколько улучшений в системе мини-приложений, чтобы обеспечить отличную привлекательность мини-приложений на любом фоне, существующем на новом экране блокировки iOS 10. Кроме того, мини-приложения теперь содержат свойство [нквиджетдисплаймоде](https://developer.apple.com/reference/notificationcenter/ncwidgetdisplaymode) , которое позволяет разработчику описать, какой объем содержимого доступен и позволяет пользователю разворачивать и сворачивать содержимое.

Мини-приложения (также известные как современные расширения) — это особый тип расширения iOS, который отображает небольшой объем полезной информации или обеспечивает своевременное предоставление функциональных возможностей для конкретных приложений. Например, в приложении для новостей есть мини-приложение, которое показывает верхние заголовки, а приложение календаря предоставляет два различных элемента: один для отображения сегодняшних событий и один для показа ближайших событий.

Мини-приложения поддерживают широкие возможности настройки и могут содержать элементы пользовательского интерфейса, такие как текст, изображения, кнопки и т. д. Кроме того, разработчик может дополнительно настроить макет своих мини-приложений.

[![](widgets-images/widgets01.png "Примеры мини-приложений")](widgets-images/widgets01.png#lightbox)

Существует два основных места, которые пользователь может просматривать и взаимодействовать с мини-приложениями приложения:

- **Экран поиска** . пользователи могут добавлять графические элементы, наиболее полезные для поиска на экране. Доступ к экрану поиска осуществляется вправо на экранах дома и на экране блокировки.
- **Начальный экран** — с главного экрана пользователь может использовать трехмерное касание для открытия списка быстрых действий, применяя давление к значку приложения. Графические элементы приложения будут отображаться над списком быстрых действий. Дополнительные сведения см. [в](~/ios/platform/3d-touch.md) документации по трехмерному касанию.

## <a name="widgets-developer-suggestions"></a>Предложения для разработчиков мини-приложений

В идеале разработчик всегда должен попытаться разработать мини-приложения, которые пользователь хочет добавить на экраны поиска. Для этого компания Apple имеет следующие рекомендации:

- **Создавайте великолепные и наглядные возможности** для пользователей, которые предоставляют краткие, наглядные сведения об обновлениях состояния или позволяют быстро выполнять простые задачи. Это обеспечивает правильный объем информации и интерактивность. По возможности разрешать пользователю выполнять определенную задачу одним касанием. Кроме того, поскольку мини-приложения не поддерживают панорамирование или прокрутку, это необходимо учитывать в структуре мини-приложения.
- **Быстро отображать содержимое** — мини-приложения предназначены для наглядного представления, поэтому пользователю никогда не придется ждать загрузки содержимого после того, как мини-приложение отобразится. Мини-приложения должны кэшировать свое содержимое локально, чтобы они могли отображать Последнее содержимое, пока содержимое загружается в фоновом режиме.
- **Предоставьте соответствующее заполнение и поля** . мини-приложения не должны выглядеть как переполненные, поэтому не следует расширять содержимое до границ представления мини-приложения. Между краями и содержимым всегда должно быть задано несколько точек. Apple также предлагает использовать значок приложения, отображаемый в верхней части мини-приложений, в качестве рекомендации по выравниванию. Если мини-приложение представляет макет сетки, убедитесь, что между элементами в сетке имеется правильное заполнение, и попытайтесь ограничить число элементов до четырех максимальных.
- **Использование адаптируемых макетов** . ширина мини-приложения зависит от устройства, на котором оно выполняется, и ориентации устройства. Высота мини-приложения также может меняться в зависимости от того, отображается ли он в свернутом (по умолчанию) или расширенном (не поддерживается всеми мини-приложениями). Свернутое мини-приложение имеет высоту примерно двух и половины стандартных строк таблицы iOS. Разработчик может запросить размер для развернутого мини-приложения, но в идеале он будет меньше, чем высота экрана. В свернутом состоянии мини-приложение должно отображать только нужные автономные сведения. При развертывании мини-приложение должно отображать дополнительные сведения, которые улучшают основное содержимое, отображаемое в свернутом состоянии. Мини-приложения, отображаемые в списке быстрого действия, будут находиться в свернутом состоянии.
- **Не следует настраивать фон мини-приложения** , отображаемые на светлом фоне, предоставленном системой. Это делается для повышения согласованности между мини-приложениями и улучшения читаемости содержимого. Избегайте использования изображения в качестве фона мини-приложения, так как оно может конфликтовать с блокировкой пользователя и начальным экраном фоновыми рисунками.
- **Использовать системный шрифт в черном или темно-сером** цвете. при отображении текста в графическом элементе лучше подходит системный шрифт. Шрифт должен быть черным или темно-серым цветом, чтобы выделяться на фоне светлого размытого мини-приложения.
- **Предоставить доступ к приложениям, когда соответствующий** мини-приложение всегда должно работать отдельно от своего приложения. Однако если требуются более глубокие функции, Мини-приложение должно иметь возможность запускать приложения для просмотра или редактирования определенного фрагмента данных. Никогда не включайте кнопку "открыть приложение", просто разрешите пользователю коснуться самого содержимого и никогда не открывайте стороннее приложение.
- **Выберите понятное, сокращенное имя мини** -приложения — значок и имя мини – приложение всегда отображаются в содержимом мини-приложений. Компания Apple предлагает использовать имя своего основного мини-приложения и понятное сокращенное имя для всех остальных, которые он предоставляет. При предоставлении названия пользовательского мини-приложения им должно быть присвоено имя (например, "карты" поблизости, "Maps" и т. д.).
- **Уведомлять о том, что при проверке подлинности добавляется значение** — если дополнительные функциональные возможности или информация доступны только при условии, что пользователь прошел проверку подлинности и вошел в систему, представим это пользователю. Например, приложение для обмена данными может сказать «войти в бюллетень».
- **Выберите мини-приложение списка быстрых действий** . Если в приложении предусмотрено более одного графического элемента, разработчик должен выбрать тот, который будет отображаться, когда пользователь выводит список быстрых действий, применяя давление к значку приложения с помощью трехмерного касания.

Дополнительные сведения о работе с мини-приложениями см. в статьях [Введение в расширения](~/ios/platform/extensions.md), [Введение в](~/ios/platform/3d-touch.md) документацию по трехмерным касаниям и [руководство по программированию расширения приложения](https://developer.apple.com/library/prerelease/content/documentation/General/Conceptual/ExtensibilityPG/index.html)Apple.

## <a name="working-with-vibrancy"></a>Работа с вибрация

Вибрация гарантирует, что текст мини-приложения остается неудобочитаемым при отображении на светлом фоне мини-приложения (предоставленном системой). До выпуска iOS 10 разработчик использовал [нотификатионцентервибранциеффект](https://developer.apple.com/reference/uikit/uivibrancyeffect/1613917-notificationcentervibrancyeffect) для своей вибрация мини-приложения. Например:

```csharp
// DEPRECATED: Get Widget Vibrancy Effect
var vibrancy = UIVibrancyEffect.CreateForNotificationCenter ();
```

В iOS 10 это не рекомендуется, поэтому его следует заменить на [виджетпримаривибранциеффект](https://developer.apple.com/reference/uikit/uivibrancyeffect/1771278-widgetprimaryvibrancyeffect) или [виджетсекондаривибранциеффект](https://developer.apple.com/reference/uikit/uivibrancyeffect/1771277-widgetsecondaryvibrancyeffect). Например:

```csharp
// Get Primary Widget Vibrancy Effect
var vibrancy = UIVibrancyEffect.CreatePrimaryVibrancyEffectForNotificationCenter ();

// Get Secondary Widget Vibrancy Effect
var vibrancy2 = UIVibrancyEffect.CreateSecondaryVibrancyEffectForNotificationCenter ();
```

## <a name="working-with-collapsed-and-expanded-widgets"></a>Работа с свернутыми и развернутыми мини-приложениями

В iOS 10 мини-приложения теперь содержат свойство [нквиджетдисплаймоде](https://developer.apple.com/reference/notificationcenter/ncwidgetdisplaymode) , которое позволяет разработчику описать, какой объем содержимого доступен, и позволяет пользователю разворачивать и сворачивать содержимое.

Когда мини-приложение отображается изначально, оно находится в свернутом состоянии. Свернутое мини-приложение имеет высоту примерно двух и половины стандартных строк таблицы iOS. Разработчик может запросить размер для развернутого мини-приложения, но в идеале он будет меньше, чем высота экрана.

В свернутом состоянии мини-приложение должно отображать только нужные автономные сведения. При развертывании мини-приложение должно отображать дополнительные сведения, которые улучшают основное содержимое, отображаемое в свернутом состоянии. Например, приложение Weather отображает текущие погодные условия при свертывании и добавляет почасовой прогноз при развертывании.

Мини-приложения, отображаемые в списке быстрого действия, будут находиться в свернутом состоянии. Если приложение предоставляет более одного мини-приложения, разработчик должен выбрать тот, который будет отображаться, когда пользователь выводит список быстрых действий, применяя давление к значку приложения с помощью трехмерного касания.

Следующий пример представляет собой простое расширение Today (мини-приложение), которое обрабатывает свернутое и развернутое состояния:

```csharp
using System;
using NotificationCenter;
using Foundation;
using UIKit;
using CoreGraphics;

namespace MonkeyAbout
{
    public partial class TodayViewController : UIViewController, INCWidgetProviding
    {
        protected TodayViewController (IntPtr handle) : base (handle)
        {
            // Note: this .ctor should not contain any initialization logic.
        }

        public override void ViewDidLoad ()
        {
            base.ViewDidLoad ();

            // Tell widget it can be expanded
            ExtensionContext.SetWidgetLargestAvailableDisplayMode (NCWidgetDisplayMode.Expanded);

            // Get the maximum size
            var maxSize = ExtensionContext.GetWidgetMaximumSize (NCWidgetDisplayMode.Expanded);
        }

        [Export ("widgetPerformUpdateWithCompletionHandler:")]
        public void WidgetPerformUpdate (Action<NCUpdateResult> completionHandler)
        {
            // Take action based on the display mode
            switch (ExtensionContext.GetWidgetActiveDisplayMode()) {
            case NCWidgetDisplayMode.Compact:
                Content.Text = "Let's Monkey About!";
                break;
            case NCWidgetDisplayMode.Expanded:
                Content.Text = "Gorilla!!!!";
                break;
            }

            // Report results
            // If an error is encoutered, use NCUpdateResultFailed
            // If there's no update required, use NCUpdateResultNoData
            // If there's an update, use NCUpdateResultNewData
            completionHandler (NCUpdateResult.NewData);
        }

        [Export ("widgetActiveDisplayModeDidChange:withMaximumSize:")]
        public void WidgetActiveDisplayModeDidChange (NCWidgetDisplayMode activeDisplayMode, CGSize maxSize)
        {
            // Take action based on the display mode
            switch (activeDisplayMode) {
            case NCWidgetDisplayMode.Compact:
                PreferredContentSize = maxSize;
                Content.Text = "Let's Monkey About!";
                break;
            case NCWidgetDisplayMode.Expanded:
                PreferredContentSize = new CGSize (0, 200);
                Content.Text = "Gorilla!!!!";
                break;
            }
        }

    }
}
```

Подробно Взгляните на конкретный код в режиме отображения мини-приложения. Чтобы сообщить системе, что это мини-приложение поддерживает развернутое состояние, оно использует:

```csharp
// Tell widget it can be expanded
ExtensionContext.SetWidgetLargestAvailableDisplayMode (NCWidgetDisplayMode.Expanded);
```

Чтобы получить текущий режим экрана мини-приложения, используется:

```csharp
ExtensionContext.GetWidgetActiveDisplayMode()
```

Чтобы получить максимальный размер для свернутого или развернутого состояния, используется:

```csharp
// Get the maximum size
var maxSize = ExtensionContext.GetWidgetMaximumSize (NCWidgetDisplayMode.Expanded);
```

Чтобы обрабатывалось изменение состояния (режим отображения), используется:

```csharp
[Export ("widgetActiveDisplayModeDidChange:withMaximumSize:")]
public void WidgetActiveDisplayModeDidChange (NCWidgetDisplayMode activeDisplayMode, CGSize maxSize)
{
    // Take action based on the display mode
    switch (activeDisplayMode) {
    case NCWidgetDisplayMode.Compact:
        PreferredContentSize = maxSize;
        Content.Text = "Let's Monkey About!";
        break;
    case NCWidgetDisplayMode.Expanded:
        PreferredContentSize = new CGSize (0, 200);
        Content.Text = "Gorilla!!!!";
        break;
    }
}
```

Помимо установки запрошенного размера для каждого состояния (свернутого или развернутого), оно также обновляет отображаемое содержимое, чтобы оно соответствовало новому размеру.

## <a name="summary"></a>Сводка

В этой статье были рассмотрены улучшения, внесенные компанией Apple в систему мини-приложений в iOS 10, и показано, как их реализовать в Xamarin. iOS.



## <a name="related-links"></a>Связанные ссылки

- [Примеры iOS 10](https://docs.microsoft.com/samples/browse/?products=xamarin&term=Xamarin.iOS+iOS10)
- [Общие сведения о расширениях](~/ios/platform/extensions.md)
- [Введение в трехмерное касание](~/ios/platform/3d-touch.md)
- [Инструкции по программированию расширения приложения](https://developer.apple.com/library/prerelease/content/documentation/General/Conceptual/ExtensibilityPG/index.html)
