---
title: Автоматический макет с Xamarin Designer для iOS
description: В этом руководство рассказывается о автоматическом макете iOS и описывается использование Xamarin Designer для iOS для создания и редактирования макетов с помощью ограничений. Здесь также обсуждается изменение ограничений в коде, Анимация изменений ограничений и многое другое.
ms.prod: xamarin
ms.assetid: CAC7A715-55BB-45E2-BB6D-2168D36D428F
ms.technology: xamarin-ios
author: lobrien
ms.author: laobri
ms.date: 03/21/2017
ms.openlocfilehash: 5545a7b044eee2f5f0c1ced7ce056423fdbf158b
ms.sourcegitcommit: 6264fb540ca1f131328707e295e7259cb10f95fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/16/2019
ms.locfileid: "69528581"
---
# <a name="auto-layout-with-the-xamarin-designer-for-ios"></a>Автоматический макет с Xamarin Designer для iOS

Автоматический макет (также называемый «адаптивным макетом») — это подход, реагирующий на быстроту разработки. В отличие от системы трехмерного макета, где расположение каждого элемента жестко запрограммировано на точку на экране, Автоматическая разметка связана с *связями* — позициями элементов относительно других элементов в области конструктора. В основе автоматического макета лежит идея ограничений или правил, определяющих размещение элемента или набора элементов в контексте других элементов на экране. Поскольку элементы не привязаны к определенной положению на экране, ограничения помогают создать адаптивный макет, хорошо выглядящий на различных размерах экрана и ориентациях устройств.

В этом разделе описаны ограничения и способы работы с ними в конструкторе Xamarin iOS. В этом руководству не рассматривается работа с ограничениями программным способом. Сведения об использовании автоматического макета программным способом см. в [документации Apple](https://developer.apple.com/library/prerelease/ios/documentation/UserExperience/Conceptual/AutolayoutPG/ProgrammaticallyCreatingConstraints.html).

## <a name="requirements"></a>Требования

Xamarin Designer для iOS доступен в Visual Studio для Mac в Visual Studio 2017 и более поздних версиях в Windows.

В этом учебнике предполагается знание компонентов конструктора из статьи [Общие сведения о конструкторе iOS](~/ios/user-interface/designer/introduction.md) .

## <a name="introduction-to-constraints"></a>Общие сведения об ограничениях

Ограничение — это математическое представление связи между двумя элементами на экране. Представление положения элемента пользовательского интерфейса в виде математической связи решает несколько проблем, связанных с жестко запрограммированным расположением элемента пользовательского интерфейса. Например, если бы в нижней части экрана в книжном режиме поместить кнопку 20px, положение кнопки будет отображаться на экране в альбомном режиме. Чтобы избежать этого, можно задать ограничение, которое помещает нижнюю границу кнопки 20px в нижней части представления. Расположение границы кнопки затем будет вычислено как *кнопка. низ = View. Bottom-20px*, которое поместит кнопку 20px из нижней части представления в книжной и альбомной ориентации. Возможность вычисления положения на основе математической связи заключается в том, что делает ограничения полезными в разработке пользовательского интерфейса.

При задании ограничения мы создаем `NSLayoutConstraint` объект, который принимает в качестве аргументов объекты, которые должны быть ограничены, и свойства или *атрибуты*, с которыми будет действовать ограничение. В конструкторе iOS атрибуты включают границы, такие как *левое*, *правое*, *верхнее*и *низ* элемента. Они также включают такие атрибуты размера, как *Высота* и *Ширина*, а также расположение центральной точки, *CenterX* и *Center*. Например, при добавлении ограничения к положению левой границы двух кнопок конструктор создает следующий код, как описано ниже.

```csharp
View.AddConstraint (NSLayoutConstraint.Create (Button1, NSLayoutAttribute.Left, NSLayoutRelation.Equal, Button2, NSLayoutAttribute.Left, 1, 10));
```

В следующем разделе рассматривается работа с ограничениями с помощью конструктора iOS, включая включение и отключение автоматического макета и использование панели инструментов ограничения.

## <a name="enable-auto-layout"></a>Включить автоматический макет

В конфигурации конструктора iOS по умолчанию включен режим ограничения. Однако если вам нужно включить или отключить его вручную, это можно сделать в два этапа:

1. Щелкните пустое пространство в области конструктора. Это отменит выбор всех элементов и выведет свойства документа раскадровки.
1. Установите или снимите флажок **использовать Автомакет** на панели свойств:

    ![](designer-auto-layout-images/image01.png "Флажок использовать Автомакет на панели свойств")


По умолчанию на поверхности не создаются и не отображаются никакие ограничения. Вместо этого они автоматически выводятся из сведений о кадре во время компиляции. Чтобы добавить ограничения, необходимо выбрать элемент в области конструктора и добавить к нему ограничения. Это можно сделать с помощью **панели инструментов ограничения**.

## <a name="constraints-toolbar"></a>Панель инструментов "ограничения"

 [![](designer-auto-layout-images/toolbarnew.png "Команды контекстного меню")](designer-auto-layout-images/toolbarnew.png#lightbox)

Панель инструментов ограничения обновлена и теперь состоит из двух основных частей:

- **Переключатель режима ограничений**: Ранее вы перешли в режим ограничений, щелкнув снова в выбранном представлении в области конструктора. Теперь этот переключатель следует использовать на панели ограничений:

  ![Переключение режимов очередностью](designer-auto-layout-images/constraints.png)

- **Кнопка "ограничения обновления":** Важно отметить, что изменения зависят от того, находится ли вы в режиме редактирования ограничений.
  - В режиме редактирования ограничений эта кнопка корректирует ограничения, чтобы они соответствовали кадру элемента.
  - В режиме редактирования кадров эта кнопка корректирует рамку элемента так, чтобы она соответствовала положению, определяемому ограничениями.


## <a name="surface-based-constraint-editing"></a>Изменение ограничения на основе поверхности

В предыдущем разделе мы узнали, как добавить ограничения по умолчанию и удалить ограничения с помощью панели инструментов ограничения. Для более точной настройки изменения ограничений можно напрямую взаимодействовать с ограничениями в области конструктора. В этом разделе приводятся основные сведения об изменении ограничений на основе поверхности, включая элементы управления "разделение на контакты", области перетаскивания и работу с различными типами ограничений.

### <a name="creating-constraints"></a>Создание ограничений

Инструмент iOS Designer предлагает два типа элементов управления для манипуляции элементами в области конструктора. *Перетаскивание элементов управления* и *элементов управления расстояниями*, как показано на следующем рисунке:

![элементы управления представления](designer-auto-layout-images/controls.png)

Они переключаются путем нажатия кнопки режим ограничений на панели ограничения.

4-образные маркеры на каждой стороне элемента определяют *верхнюю*, *правую*, *нижнюю*и *левую* границы элемента для ограничения. Два маркера в форме, расположенные справа и снизу элемента, определяют ограничения *высоты* и *ширины* соответственно. Средний квадрат обрабатывает ограничения *CenterX* и *Center* .

Чтобы создать ограничение, выберите маркер и перетащите его в область конструктора. Когда вы начнете перетаскивание, на поверхности появится ряд зеленых линий или квадратиков, которые будут использоваться для ограничения. Например, на следующем снимке экрана мы ограничивающи верхнюю сторону средней кнопки:

 [![](designer-auto-layout-images/image07.png "Ограничение верхней части средней кнопки")](designer-auto-layout-images/image07.png#lightbox)

Обратите внимание на три пунктирных зеленой линии на двух других кнопках. Зеленые линии обозначают *области перетаскивания*или атрибуты других элементов, с которыми можно ограничиться. На снимке экрана выше две другие кнопки предлагают три вертикальных области перетаскивания ( *снизу*, по *центру*, *сверху*), чтобы ограничить нашу кнопку. Пунктирная зеленая линия в верхней части представления означает, что контроллер представления предлагает ограничение в верхней части представления, а сплошной зеленый прямоугольник означает, что контроллер представления предлагает ограничение, которое находится ниже верхней структуры макета.

> [!IMPORTANT]
> Направляющие разметки — это специальные типы целевых объектов ограничений, позволяющие создавать ограничения верхнего и нижнего уровня, которые принимают во внимание наличие системных панелей, таких как строки состояния или панели инструментов. Одно из основных применений заключается в том, чтобы приложение было совместимо между iOS 6 и iOS 7, так как в последней версии представление контейнера находится под строкой состояния. Дополнительные сведения о верхней части руководства по разметке см. в [документации Apple](https://developer.apple.com/library/ios/documentation/userexperience/conceptual/transitionguide/AppearanceCustomization.html#//apple_ref/doc/uid/TP40013174-CH15-SW2).



В следующих трех разделах описывается работа с различными типами ограничений.

### <a name="size-constraints"></a>Ограничения размера

С ограничениями размера — *Высота* и *Ширина* — у вас есть два варианта. Первый вариант — перетащить маркер, чтобы ограничить размер соседнего элемента, как показано в примере выше. Другой вариант — дважды щелкнуть маркер, чтобы создать самоограничение. Это позволяет нам указать значение постоянного размера, как показано на снимке экрана ниже:

 [![](designer-auto-layout-images/sizec.png "Перетащите маркер, чтобы ограничить размер соседнего элемента, как показано здесь")](designer-auto-layout-images/sizec.png#lightbox)

### <a name="center-constraints"></a>Ограничения центра

Квадратный маркер создаст CenterXное или Центрированное ограничение в зависимости от контекста. Перетаскивание квадратного маркера приведет к освещению других элементов, предлагающих вертикальные и горизонтальные области перетаскивания, как показано на снимке экрана ниже:

 [![](designer-auto-layout-images/centerc.png "Ограничения центра")](designer-auto-layout-images/centerc.png#lightbox)

Если выбрана вертикальная область перетаскивания, будет создано ограничение по *центру* . При выборе горизонтальной области перетаскивания ограничение будет основываться на *CenterX*.

### <a name="combinational-constraints"></a>Комбинированные ограничения

Чтобы создать ограничения выравнивания и равенства размера между двумя элементами, можно выбрать элементы на верхней панели инструментов, чтобы задать выравнивание по горизонтали, вертикальное выравнивание и размер екуалитиес, как показано на снимке экрана ниже:

 [![](designer-auto-layout-images/image06.png "Комбинированные ограничения")](designer-auto-layout-images/image06.png#lightbox)

### <a name="visualizing-and-editing-constraints"></a>Визуализация и редактирование ограничений

При добавлении ограничения оно будет отображаться в области конструктора в виде синей линии при выборе элемента:

 [![](designer-auto-layout-images/image09.png "Визуализация ограничений")](designer-auto-layout-images/image09.png#lightbox)

Можно выбрать ограничение, щелкнув синюю линию и изменив значения ограничений непосредственно на панели свойств. Кроме того, при двойном щелчке на синей линии появится контекстном меню Action, позволяющий изменить значения непосредственно в области конструктора.

 [![](designer-auto-layout-images/image08.png "Изменение ограничений")](designer-auto-layout-images/image08.png#lightbox)

## <a name="constraint-issues"></a>Проблемы с ограничениями

При использовании ограничений могут возникать проблемы с несколькими типами:

- **Конфликтующие ограничения** — это происходит, когда несколько ограничений приводят к принудительному возникновению у элемента конфликтующих значений атрибута, и подсистеме ограничения не удается согласовать их.
- **Элементы** с неограниченным доступом — свойства элемента (расположение и размер) должны полностью полагаться на набор ограничений и встроенных размеров, чтобы ограничения были допустимыми. Если эти значения неоднозначны, элемент считается неограниченным.
- Некоторая **Рамка кадра** — это происходит, когда кадр элемента и его набор ограничений определяют два разных результирующих прямоугольника.


В этом разделе описываются три проблемы, перечисленные выше, и приводятся подробные сведения об их обработке.

### <a name="conflicting-constraints"></a>Конфликтующие ограничения

Конфликтующие ограничения отмечены красным цветом и содержат символ предупреждения. При наведении указателя мыши на символы предупреждения появляется контекстном меню Action со сведениями о конфликте:

 [![](designer-auto-layout-images/image11.png "Предупреждение об конфликтующих ограничениях")](designer-auto-layout-images/image11.png#lightbox)

### <a name="underconstrained-items"></a>Элементы с неограниченным ограничением

Элементы с неограниченным набором текста отображаются оранжевым цветом и инициируют внешний вид оранжевого значка маркера на панели объектов контроллера представления.

 [![](designer-auto-layout-images/image02.png "Элементы с неограниченным ограничением отображаются оранжевым цветом")](designer-auto-layout-images/image02.png#lightbox)

Если щелкнуть значок маркера, можно получить сведения о неограниченных элементах в сцене и решить проблемы, полностью ограничив их или удалив их ограничения, как показано на снимке экрана ниже:

 [![](designer-auto-layout-images/image10.png "Исправление элементов с неограниченным ограничением")](designer-auto-layout-images/image10.png#lightbox)

### <a name="frame-misplacement"></a>Некоторая Рамка кадра

В случае неточного размещения фрейма используется тот же цветовой код, что и элементы с неограниченным набором. Элемент всегда будет отображаться на поверхности, используя его собственный кадр, но в случае несущего кадра красный прямоугольник пометит, где будет достигнут элемент при запуске приложения, как показано на снимке экрана ниже:

 [![](designer-auto-layout-images/image05.png "Пример представления с незаменой кадров")](designer-auto-layout-images/image05.png#lightbox)

Чтобы устранить ошибки при обнаружении ошибок в кадрах, нажмите кнопку **Обновить кадры на основе ограничений** на панели инструментов ограничения (кнопка вправо):

 [![](designer-auto-layout-images/image03.png "Обновление кадров на основе кнопки на панели инструментов для ограничений")](designer-auto-layout-images/image03.png#lightbox)

При этом рамка элемента будет автоматически настроена в соответствии с позициями, определенными элементами управления.

<a name="modifying-in-code" />

## <a name="modifying-constraints-in-code"></a>Изменение ограничений в коде

В зависимости от требований приложения могут возникнуть ситуации, когда необходимо изменить ограничение в коде. Например, чтобы изменить размер или переместить представление, к которому присоединено ограничение, измените приоритет ограничения или полностью отключите ограничение.

Чтобы получить доступ к ограничению в коде, необходимо сначала предоставить его в конструкторе iOS, выполнив следующие действия.

1. Создайте ограничение обычным образом (используя любой из перечисленных выше методов).
2. В **обозревателе структуры документа**найдите нужное ограничение и выберите его:

    [![](designer-auto-layout-images/modify01.png "Обозреватель структуры документа")](designer-auto-layout-images/modify01.png#lightbox)
3. Затем назначьте **имя** ограничению на вкладке **мини** -приложение **обозревателя свойств**:

    [![](designer-auto-layout-images/modify02.png "Вкладка мини-приложения")](designer-auto-layout-images/modify02.png#lightbox)
4. Сохраните изменения.

Выполнив приведенные выше изменения, можно получить доступ к ограничению в коде и изменить его свойства. Например, можно использовать следующую команду, чтобы установить высоту присоединенного представления равным нулю:

```csharp
ViewInfoHeight.Constant = 0;
```

С учетом следующего параметра для ограничения в конструкторе iOS:

[![](designer-auto-layout-images/modify03.png "Изменение ограничения в обозревателе свойств")](designer-auto-layout-images/modify03.png#lightbox)

### <a name="the-deferred-layout-pass"></a>Отложенный проход макета

Вместо мгновенного обновления присоединенного представления в ответ на изменения ограничений обработчик автоматических макетов планирует _проход отложенного макета_ в ближайшем будущем. Во время этого отложенного прохода не только обновленное ограничение данного представления, но и все ограничения для каждого представления в иерархии пересчитываются и обновляются для изменения в новом макете.

В любой момент можно запланировать собственный проход отложенного макета, вызвав `SetNeedsLayout` методы или `SetNeedsUpdateConstraints` родительского представления. 

Отложенный проход макета состоит из двух уникальных проходов через иерархию представлений:

- Во всех представлениях передается следующий проход **обновления** : обработчик разметки проходит по иерархии представления и вызывает `UpdateViewConstraints` метод для всех контроллеров `UpdateConstraints` представления и метод.
- **Передаваемый макет** , обработчик автоматической разметки проходит по иерархии представлений, но в этот раз вызывает `ViewWillLayoutSubviews` метод для всех контроллеров `LayoutSubviews` представления и метод для всех представлений. `LayoutSubviews` Метод`Frame` обновляет свойство каждого подпредставления с прямоугольником, вычисленным обработчиком автоматической разметки.

### <a name="animating-constraint-changes"></a>Анимация изменений ограничений

В дополнение к изменению свойств ограничений можно использовать основную анимацию для анимации изменений в ограничениях представления. Например:

```csharp
UIView.BeginAnimations("OpenInfo");
UIView.SetAnimationDuration(1.0f);
ViewInfoHeight.Constant = 237;
View.LayoutIfNeeded();

//Execute Animation
UIView.CommitAnimations();
```

Ключ здесь вызывает `LayoutIfNeeded` метод родительского представления внутри блока анимации. Это означает, что представление будет рисовать каждый «кадр» анимированного расположения или изменения размера. Без этой строки представление будет просто привязано к окончательной версии без анимации.

## <a name="summary"></a>Сводка

Это руководство посвящено автоматическому (или адаптивному) макету iOS и концепции ограничений в виде математических представлений связей между элементами в области конструктора. В нем описывается включение автоматического макета в конструкторе iOS, работа с панелью **ограничения**и изменение ограничений по отдельности в области конструктора. Далее было объяснено, как устранить три проблемы, связанные с общими ограничениями. Наконец, было показано, как изменить ограничения в коде.

## <a name="related-links"></a>Связанные ссылки

- [Введение в раскадровку](~/ios/user-interface/storyboards/index.md)
- [Пошаговое руководство по разработке элементов управления для iOS](~/ios/user-interface/designer/ios-designable-controls-walkthrough.md)
- [Обзор Android Designer](~/android/user-interface/android-designer/index.md)
- [Программные ограничения](~/ios/user-interface/programmatic-layout-constraints.md)
- [Автоматическое создание макета Apple](https://developer.apple.com/library/ios/documentation/userexperience/conceptual/AutolayoutPG/Introduction/Introduction.html#/apple_ref/doc/uid/TP40010853-CH13-SW1)
