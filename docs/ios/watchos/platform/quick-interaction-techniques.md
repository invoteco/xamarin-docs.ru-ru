---
title: Методы быстрого взаимодействия для watchOS 3 в Xamarin
description: В этой статье рассматриваются методы быстрого взаимодействия, добавленные компанией Apple в watchOS 3, и способы их реализации в Xamarin. iOS для Apple Watch.
ms.prod: xamarin
ms.assetid: 26697F68-AF7E-4A36-988F-85E2674A4DD1
ms.technology: xamarin-ios
author: conceptdev
ms.author: crdun
ms.date: 03/17/2017
ms.openlocfilehash: a0719dce3b7f5484168dc5679237b01286f5de78
ms.sourcegitcommit: 933de144d1fbe7d412e49b743839cae4bfcac439
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/04/2019
ms.locfileid: "70286758"
---
# <a name="quick-interaction-techniques-for-watchos-3-in-xamarin"></a>Методы быстрого взаимодействия для watchOS 3 в Xamarin

_В этой статье рассматриваются методы быстрого взаимодействия, добавленные компанией Apple в watchOS 3, и способы их реализации в Xamarin. iOS для Apple Watch._

Обеспечение быстрого взаимодействия с пользователем очень важно для создания привлекательных Apple Watch приложений и сложностей. Впервые watchOS 3, компания Apple добавила поддержку распознавателей жестов, доступа к Digital Crownу и новым методам уведомления и навигации пользователей. Кроме того, благодаря добавленной поддержке как для SceneKit, так и для SpriteKit, разработчики могут легко создавать многофункциональные и быстрые интерфейсы, быстро и реагирующие.

## <a name="what-are-quick-interactions"></a>Что такое быстрые взаимодействия

Для разработчика, который используется для создания приложений для iOS или macOS (где время, затрачиваемое пользователем на взаимодействие с приложением, измеряется в минутах или часах), разработка успешного приложения для Apple Watch может быть сложной задачей и требует другого подход.

В watchOS пользователь, как правило, хочет подать свой собственный, быстро взаимодействовать с приложением (обычно в течение короткого ряда секунд), а затем удалить их и продолжить работу.

Ниже приведено несколько примеров быстрого взаимодействия на Apple Watch.

- Запуск таймера.
- Проверка погоды.
- Пометка элемента в списке ToDo.

Для достижения этих целей приложение на Apple Watch должно быть:

- Это означает, что с кратким **обзором** пользователь должен иметь возможность получить необходимую информацию. 
- **Это означает** , что пользователи должны иметь возможность принимать быстрые и тщательно обоснованные решения.
- **Реагирование** . Это означает, что пользователь никогда не должен ждать получения необходимых сведений или для достижения требуемого действия.

### <a name="quick-interactions-length"></a>Длина быстрых взаимодействий

Из-за краткой природы Apple Watch приложений компания Apple рекомендует, чтобы Идеальная продолжительность быстрого взаимодействия не превышала двух секунд. В результате этого 2-секундного ограничения разработчику потребуется потратить значительное количество времени как на разработку, так и на реализацию приложения Apple Watch. 

## <a name="new-watchos-3-features-and-apis"></a>Новые функции и API-интерфейсы watchOS 3

Компания Apple добавила несколько новых функций и API-интерфейсов в WatchKit, чтобы помочь разработчикам в добавлении быстрых взаимодействий с Apple Watch приложениями:

- watchOS 3 предоставляет доступ к новым типам вводимых пользователем данных, таким как:
  - Распознаватели жестов
  - Вращение Digital Crown 
- watchOS 3 предоставляет новые способы отображения и обновления информации, например:
  - Улучшенная навигация по таблицам
  - Поддержка новой платформы уведомлений пользователей
  - Интеграция SpriteKit и SceneKit

Реализуя эти новые функции, разработчик может гарантировать, что их приложение watchOS 3 будет доступно для просмотра, выполнения действий и реагирования.

### <a name="gesture-recognizer-support"></a>Поддержка распознавателя жестов

Если разработчик реализовал распознаватели жестов в iOS, они должны быть очень знакомы с тем, как распознаватели жестов работают в watchOS 3. Для обновления распознаватели жестов — это объекты, которые анализируют низкоуровневые события касания на распознаваемые, заранее определенные жесты.

watchOS 3 будет поддерживать четыре следующих распознавателя жестов:

- Дискретные типы жестов:
  - Жест прокрутки`WKSwipeGestureRecognizer`().
  - Жест касания (`WKTapGestureRecognizer`).
- Типы непрерывных жестов:
  - Жест панорамирования (`WKPanGestureRecognizer`).
  - Жест длительного нажатия (`WKLongPressGestureRecognizer`).

Чтобы реализовать один из новых распознавателей жестов, просто перетащите его в область конструктора в конструкторе iOS в Visual Studio для Mac и настройте его свойства.

В коде ответьте на действие распознавателя, чтобы обработать жест, активируемый пользователем. Опять же, это делается так же, как и в iOS.

#### <a name="discrete-gesture-states"></a>Дискретные состояния жестов

Для дискретных жестов действие вызывается при распознавании жеста, а состояние (`WKGestureRecognizerState`) назначается как:

[![](quick-interaction-techniques-images/quick01.png "Дискретные состояния жестов")](quick-interaction-techniques-images/quick01.png#lightbox)

Все дискретные жесты запускаются в `Possible` состоянии и переходят `Failed` в состояние или `Recognized` . При использовании дискретных жестов разработчик обычно не работает напрямую с состоянием. Вместо этого они используют действие, вызываемое, когда жест распознается только.

#### <a name="continuous-gesture-states"></a>Непрерывные состояния жестов

Непрерывные жесты немного отличаются от дискретных жестов, где действие вызывается несколько раз при распознавании жеста:

[![](quick-interaction-techniques-images/quick02.png "Непрерывные состояния жестов")](quick-interaction-techniques-images/quick02.png#lightbox)

Опять же, непрерывные жесты начинаются в `Possible` состоянии, но они выполняются над несколькими обновлениями. В этом случае разработчику необходимо принять во внимание состояние распознавателя и обновить пользовательский интерфейс приложения на этапе `Changed` , пока жест `Recognized` не закончится `Canceled`или.

#### <a name="gesture-recognizer-usage-tips"></a>Советы по использованию распознавателя жестов

При работе с распознавателями жестов в watchOS 3 рекомендуется следующее:

- Добавьте распознаватели жестов к элементам группы, а не к отдельным элементам управления. Так как Apple Watch имеет меньший размер физического экрана, элементы группы, как правило, больше и более простые целевые объекты для пользователя. Кроме того, распознаватели жестов могут конфликтовать с встроенными жестами, которые уже находятся в собственных элементах управления пользовательского интерфейса.
- Установка отношений зависимости в раскадровке приложения Watch.
- Некоторый жест имеет приоритет над другими типами жестов, например:
  - Прокрутка
  - Force Touch
 
### <a name="digital-crown-rotation"></a>Вращение Digital Crown

Реализуя поддержку Digital Crown в своих приложениях watchOS 3, разработчик может обеспечить повышенную скорость навигации и взаимодействия с точностью для своих пользователей.

Начиная с watchOS 2, Apple Watch приложение может использовать `WKInterfacePicker` объект для доступа к Digital Crown, предоставляя `WKPickerItems` список и стиль выбора (список, стек или последовательность изображений). затем watchOS разрешает пользователю использовать Digital Crown для выбора элемента из списка.

При использовании `WKInterfacePicker`, WatchKit обрабатывает большую часть работы следующим образом.

- Рисование списка и отдельных элементов интерфейса.
- Обработка событий Digital Crown.
- Вызов действия при выборе элемента.

В watchOS 3 разработчик теперь имеет прямой доступ к событиям поворота Digital Crown, что позволяет им создавать собственные элементы пользовательского интерфейса, реагирующие на значения поворота.

Digital Crown доступ предоставляется следующими элементами:

- `WKCrownSequencer`— Предоставляет доступ к поворотам в секунду.
- `WKCrownDelegate`— Предоставляет доступ к циклическим событиям смещения.

#### <a name="rotations-per-second"></a>Поворотов в секунду

Доступ к поворотам в секунду из Digital Crown полезен при работе с анимациями на основе физических объектов. Чтобы получить доступ к поворотам в секунду, используйте `CrownSequencer` свойство `WKInterfaceController` объекта расширения Watch. Например:

```csharp
var rotationsPerSecond = CrownSequencer.RotationsPerSecond;
```

#### <a name="rotational-deltas"></a>Изменения ротации

Для подсчета числа поворотов используйте поворотные разницы из Digital Crown. `WKCrownDelegate` Используйте метод `CrownDidRotate` override объекта, чтобы получить доступ к вращательным сдвигам. Например:

```csharp
using System;
using WatchKit;
using Foundation;

namespace MonkeyWatch.MonkeySeeExtension
{
  public class CrownDelegate : WKCrownDelegate
  {
    #region Computed Properties
    public double AccumulatedRotations { get; set;}
    #endregion

    #region Constructors
    public CrownDelegate ()
    {
    }
    #endregion

    #region Override Methods
    public override void CrownDidRotate (WKCrownSequencer crownSequencer, double rotationalDelta)
    {
      base.CrownDidRotate (crownSequencer, rotationalDelta);

      // Accumulate rotations
      AccumulatedRotations += rotationalDelta;
    }
    #endregion
  }
}
```

Здесь приложение поддерживает накапливаемое (`AccumulatedRotations`) для определения числа поворотов. Один полный поворот Digital Crown равен накопленной разности `1.0` и половинным поворотом. `0.5`

Компания Apple пропустила ее разработчику, чтобы определить, как счетчики вращения соответствуют чувствительности изменений обновляемого элемента пользовательского интерфейса.

Знак (`+/-`) разностной разницы указывает направление, в котором пользователь переключается Digital Crown:

[![](quick-interaction-techniques-images/quick03.png "Знак разностной разницы указывает направление, в котором пользователь переключается Digital Crown")](quick-interaction-techniques-images/quick03.png#lightbox)


Если пользователь прокручивается вверх, WatchKit возвратит положительные результаты, а при прокрутке вниз будет возвращено отрицательное число разностей, независимо от ориентации, в которой пользователь людьми в просмотр.

#### <a name="digital-crown-focus"></a>Digital Crown фокус

Как и любые другие элементы интерфейса, Digital Crown имеет понятие фокуса. Этот фокус можно сдвинуть с Digital Crown на другие элементы интерфейса в зависимости от того, как пользователь взаимодействует с часами. 

Например, любой из следующих элементов управления может украсть фокус Digital Crown:

- Средство выбора
- Slider
- Контроллер прокрутки

Разработчик должен определить, когда элемент пользовательского интерфейса должен быть фокусом Digital Crown. Компания Apple предлагает использовать новые распознаватели жестов для получения фокуса в пользовательском элементе пользовательского интерфейса.

### <a name="vertical-paging"></a>Вертикальный разбиение на страницы

Стандартный способ, которым пользователь переходит по табличному представлению в приложении watchOS, — это прокрутка до нужной части данных, нажатие на определенную строку для отображения подробного представления, нажмите кнопку "назад", чтобы просмотреть подробные сведения, и повторите процесс для любой другой информации, которую y интересуются в таблице:

[![](quick-interaction-techniques-images/quick04.png "Перемещение между таблицей и подробным представлением")](quick-interaction-techniques-images/quick04.png#lightbox)

Новый для watchOS 3, разработчик может включить вертикальное разбиение на страницы элементов управления табличного представления. Если эта функция включена, пользователь может выполнить прокрутку, чтобы найти строку представления таблицы, и коснуться строки, чтобы просмотреть ее сведения. Однако теперь они могут выбрать следующую строку в таблице или вниз, чтобы выбрать предыдущую строку (или использовать Digital Crown), но не нужно сначала возвращаться к представлению таблицы:

[![](quick-interaction-techniques-images/quick05.png "Перемещение между таблицей и подробным представлением и прокрутка вверх и вниз для перемещения между другими строками")](quick-interaction-techniques-images/quick05.png#lightbox)

Чтобы включить этот режим, откройте раскадровку приложения watchOS в Xcode для редактирования, выберите табличное представление и установите флажок **вертикальная разбивка на страницы** :

[![](quick-interaction-techniques-images/quick06.png "Установите флажок вертикальная разбивка на страницы")](quick-interaction-techniques-images/quick06.png#lightbox)

Убедитесь, что таблица использует переходов для отображения подробного представления и сохранения изменений в раскадровке, и возврата в Visual Studio для Mac для синхронизации.

Разработчик может программно привлекать вертикальный разбиение по страницам к определенной строке, используя следующий код в представлении таблицы:

```csharp
// Segue into Vertical Paging and select the first row
MenuTable.PerformSegue (0);
```

При использовании вертикального разбиения на страницы разработчик должен знать, что WatchKit будет автоматически обрабатывать предварительную загрузку контроллеров и в результате некоторые методы жизненного цикла контроллера могут быть вызваны до того, как пользовательский интерфейс станет видимым.

### <a name="notification-enhancements"></a>Усовершенствования уведомлений

Уведомление — это основная форма быстрого взаимодействия, с которой пользователь обычно работает на watchOS и который был доступен с момента первого Apple Watch и watchOS 1.

Типичное быстрое взаимодействие с уведомлениями выглядит следующим образом:

1. Пользователь нахаптик уведомление при получении нового уведомления.
2. Они порождают свой собственный, чтобы увидеть краткий интерфейс для уведомления.
3. Если они продолжают удерживать свое порождение, watchOS автоматически переходит в интерфейс длинного уведомления.

Существует несколько способов, с помощью которых пользователь может ответить на уведомление:

- Для хорошо определенного и представленного уведомления пользователь не будет выполнять никаких действий и просто отклонить уведомление.
- Они также могут коснуться уведомления, чтобы запустить приложение watchOS.
- Для уведомления, которое поддерживает настраиваемые действия, пользователь может выбрать одно из настраиваемых действий. Это может быть:
  - **Действия переднего плана** — они запускают приложение для выполнения действия.
  - **Фоновые действия** — всегда направляются на iPhone в watchOS 2, но могут направляться в Ватчапп в watchOS 3.

Новое для watchOS 3:

- В уведомлении используется аналогичный API на всех платформах (iOS, watchOS, tvOS и macOS).
- Локальное уведомление можно запланировать на Apple Watch.
- Фоновое уведомление будет направляться в расширение приложения, если они были запланированы на Apple Watch.

#### <a name="notification-scheduling-and-delivery"></a>Планирование и доставка уведомлений

Уведомление от iPhone пользователя будет пересылаться Apple Watch в следующих случаях:

- Экран iPhone отключен.
- Apple Watch надеты и был разблокирован.

В watchOS 3 локальные уведомления могут быть запланированы на Apple Watch и доставляются только в часы. Разработчик может запланировать соответствующее уведомление iPhone, если оно требуется для приложения.

Включив один и тот же идентификатор уведомления как для версии Apple Watch, так и для iPhone уведомлений, это предотвращает отображение в контрольных значениях повторяющихся уведомлений. Версия Apple Watch уведомления будет иметь приоритет над версией iPhone.

Поскольку watchOS 3 использует ту же `UINotification` платформу API, что и iOS 10, дополнительные сведения см. в документации по [пользовательской инфраструктуре уведомлений](~/ios/platform/user-notifications/index.md) iOS 10.

### <a name="using-spritekit-and-scenekit"></a>Использование SpriteKit и SceneKit

Новые возможности для watchOS 3. Теперь разработчик может использовать объекты Сприткит и SceneKit в разработке пользовательского интерфейса приложения для представления двухмерной и трехмерной графики.

Для поддержки этой функции были добавлены два новых класса интерфейсов:

- `WKInterfaceSKScene`— Для работы с SpriteKit двухмерной графикой.
- `WKInterfaceSCNScene`— Для работы с SceneKit трехмерной графикой.

Чтобы использовать эти объекты, просто перетащите их в область конструктора в раскадровке приложения Interface Builder Xcode и используйте **инспектор атрибутов** для их настройки.

С этого момента работа с сценой SpriteKit или SceneKit работает так же, как и в приложении iOS. Приложение Watch будет представлять `WKInterfaceSKScene` , вызвав один `Present` из методов. Для SceneKit просто задайте `Scene` свойство `WKInterfaceSCNScene` объекта.

## <a name="actionable-complications"></a>Недейственные сложности

В watchOS 2 компания Apple представила сложности для сторонних приложений. В watchOS 3 Компания Apple расширила возможности, которые разработчик может включить в WatchKit сложность. 

Кроме того, многие из встроенных наблюдателей теперь могут включать сложности и существующие наблюдатели, которые уже поддерживаются, теперь могут содержать еще больше осложнений.

Кроме того, Новая возможность позволяет пользователю быстро прокручивать влево или вправо для перехода от всех сторон просмотра, установленных на их Apple Watch. Используя новую галерею в вспомогательном приложении iPhone Apple Watch, пользователь может добавлять и настраивать новые лица для просмотра и любые сложности, которые они могут включать.

Из-за этих новых функций компания Apple предлагает, чтобы каждое приложение на Apple Watch также включало по крайней мере одну сложность и, как таковое, все приложения собственного Apple Watch теперь имеют сложности.

Сложности предоставляют приложению следующие функции:

- Они очень наглядны, так как они всегда есть на смотреть.
- Сложности часто обновляются с помощью watchOS. Любое приложение, которое содержит сложность отображаемого в данный момент пользователя, обновляется по крайней мере дважды в час.
- Любое приложение с усложнением отображаемого в настоящее время контрольного лица пользователя хранится в памяти, что позволяет быстро запустить приложение и повысить скорость реагирования приложения.
- Сложности облегчают пользователю запускать определенные функции в приложении watchOS.

## <a name="glanceable-notification"></a>Наглядное уведомление

Уведомление на Apple Watch предоставляет отличный, настраиваемый способ быстрого информирования пользователя о событиях или новых данных, таких как входящие сообщения или достижение цели в приложении тренировки.

С помощью уведомления можно быстро представить пользователю ценную информацию. Во многих ситуациях хорошо спроектированное уведомление может устранить потребность пользователя в фактическом запуске приложения.

Новое в watchOS 3, все уведомления теперь поддерживают:

- SpriteKit
- SceneKit
- Встроенное видео

## <a name="enhanced-ui-with-spritekit-and-scenekit"></a>Улучшенный интерфейс с SpriteKit и SceneKit

Как правило, разработчик может подумать об ИНТЕРФЕЙСе игры при упоминании SpriteKit и SceneKit. Однако SpriteKit и SceneKit могут быть полезны при создании неигровых пользовательских интерфейсов, которые включают в себя настроенные макеты, содержимое и анимацию, которые иным образом не могут быть в WatchKit.

Например, пользовательское уведомление из приложения для обмена фотографиями может использовать SpriteKit, чтобы обеспечить широкие возможности взаимодействия с пользователем, включая пользователя, который опубликовал изображение вместе с реальным изображением, и другие настраиваемые сведения, которые расширяют возможности взаимодействия с пользователем.

Кроме того, SpriteKit и SceneKit можно комбинировать с стандартными элементами пользовательского интерфейса WatchKit в структуре пользовательского интерфейса приложения.

## <a name="simple-navigation"></a>Простая навигация

в watchOS 3 представлено несколько способов упрощения навигации в своих watchOS приложениях, таких как новая [вертикальная разбивка на страницы](#vertical-paging), [Поддержка распознавателя жестов](#gesture-recognizer-support) и [Digital Crown функции ротации](#digital-crown-rotation) , представленные выше.

Digital Crown уникален для Apple Watch и может использоваться различными способами для упрощения навигации. Например, приложение таймера может использовать Digital Crown для очистки по доступной длине таймера.

Пользовательские жесты могут представлять новые и уникальные способы взаимодействия пользователя с приложением наблюдения и также могут использоваться для упрощения навигации по приложениям.

Apple рекомендует искать способы объединения всех новых функций быстрого взаимодействия, добавленных в watchOS 3, чтобы предоставить широкие, простые и быстрые возможности для использования интерфейсов приложений watchOS.

## <a name="finishing-the-quick-interaction"></a>Завершение быстрого взаимодействия

Хорошо спроектированное быстрое взаимодействие даст пользователю уверенность в удалении своих наличных (и ClassInterfaceAttribute отключите с приложением), когда они закончат текущее взаимодействие.

Там, где это становится проблемой, является то, что приложение наблюдения выполняет какие-либо типы сетевых подключений или совместное использование информации с сопутствующим приложением iPhone. Это часто может привести к индикатору ожидания во время выполнения транзакции, что нежелательно при быстром взаимодействии. Рассмотрим следующий пример:

[![](quick-interaction-techniques-images/quick07.png "Схема приложения Watch, выполняющего сетевое подключение и совместное использование информации с сопутствующим приложением iPhone")](quick-interaction-techniques-images/quick07.png#lightbox)

1. Пользователь выбирает элемент для покупки на часах.
2. Нажмите кнопку Купить.
3. Приложение запускает сетевую транзакцию и отображает индикатор загрузки.
4. Спустя некоторое время транзакция завершается, и приложение выводит на экран соответствующее соответствие.
5. Пользователь удаляет себя и выходит из приложения.

С момента, когда пользователь нажмет кнопку "Купить" до завершения транзакции, он порождается на индикаторе загрузки. Чтобы решить эту проблему, компания Apple предлагает разработчику мгновенное отзыв пользователю вместо отображения индикатора загрузки. 

Используя предлагаемую модель Apple, ознакомьтесь с тем же быстрым взаимодействием еще раз:

[![](quick-interaction-techniques-images/quick08.png "Схема рекомендуемой модели яблока")](quick-interaction-techniques-images/quick08.png#lightbox)

1. Пользователь выбирает элемент для покупки на часах.
2. Нажмите кнопку Купить.
3. Приложение запускает сетевую транзакцию и выводит сообщение о том, что покупка успешно началась.
4. Пользователь удаляет себя и выходит из приложения.
5. Когда транзакция будет успешно завершена через некоторое время, приложение отобразит локальное уведомление для информирования пользователя об успешной покупке.

На этот раз, как только пользователь нажмет кнопку "Купить", отображается сообщение о том, что покупка началась, поэтому они могут уверенно удалить свой перенос и завершить быстрое взаимодействие на этом этапе. Позже они сообщают об успешном или неуспешном завершении транзакции в уведомлении пользователя. Таким образом, пользователь взаимодействует с приложением только во время "активных" этапов процесса.

Для приложений, выполняющих сетевые подключения, они могут использовать фон `NSURLSession` для связи с задачей загрузки сети. Это позволит приложению быть пробуждении в фоновом режиме для обработки загруженных данных. Для приложения, требующего фоновой обработки, используйте утверждение фоновой задачи для обработки необходимой обработки.

## <a name="quick-interaction-design-tips"></a>Советы по проектированию быстрого взаимодействия

Поскольку Желаемая длина быстрого взаимодействия составляет не более двух секунд, разработчик должен сосредоточиться на проектировании взаимодействия приложения с самого начала процесса разработки. Найдите области, в которых можно упростить эти взаимодействия (с помощью описанного выше метода) и используйте новые функции watchOS 3, чтобы ускорить и быстро реагировать на приложения.

Компания Apple предлагает следующее:

- Сосредоточьтесь на быстрых взаимодействиях, переведя наиболее используемые функции приложения вперед.
- Используйте сложности и уведомления пользователей для отображения общих функций и функций.
- Создавайте многофункциональный, наглядный пользовательский интерфейс с помощью SceneKit и SpriteKit.
- По возможности Упростите навигацию внутри приложения.
- Никогда не допускайте пользователю ожидания, позволяя им как можно быстрее удалить свои наличные и ClassInterfaceAttribute отключите с приложением.

## <a name="summary"></a>Сводка

В этой статье были рассмотрены методы быстрого взаимодействия, добавленные компанией Apple в watchOS 3, и способы их реализации в Xamarin. iOS для Apple Watch.

## <a name="related-links"></a>Связанные ссылки

- [Примеры watchOS](https://docs.microsoft.com/samples/browse/?products=xamarin&term=Xamarin.iOS+watchOS)
