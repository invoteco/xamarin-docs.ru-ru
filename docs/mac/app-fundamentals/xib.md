---
title: файлы XIB в Xamarin. Mac
description: В этой статье рассматривается работа с XIB-файлами, созданными в Interface Builder Xcode для создания и обслуживания пользовательских интерфейсов для приложения Xamarin. Mac.
ms.prod: xamarin
ms.assetid: 6AF3D216-448D-4B2D-9026-74E4FFF5923A
ms.technology: xamarin-mac
author: conceptdev
ms.author: crdun
ms.date: 03/14/2017
ms.openlocfilehash: be737dfb92cf2ce90dc64dd527f908d52cf2c580
ms.sourcegitcommit: 9bfedf07940dad7270db86767eb2cc4007f2a59f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/21/2019
ms.locfileid: "70770351"
---
# <a name="xib-files-in-xamarinmac"></a>файлы XIB в Xamarin. Mac

_В этой статье рассматривается работа с XIB-файлами, созданными в Interface Builder Xcode для создания и обслуживания пользовательских интерфейсов для приложения Xamarin. Mac._

> [!NOTE]
> Предпочтительным способом создания пользовательского интерфейса для приложения Xamarin. Mac является раскадровка. Эта документация была оставлена по историческим причинам и для работы с более старыми проектами Xamarin. Mac. Дополнительные сведения см. [в статье Введение в](~/mac/platform/storyboards/index.md) документацию по раскадровкам.

## <a name="overview"></a>Обзор

При работе с C# и .NET в приложении Xamarin. Mac у вас есть доступ к тем же элементам пользовательского интерфейса и средствам, что и разработчик, работающий на *уровне цели-C* и *Xcode* . Так как Xamarin. Mac интегрируется напрямую с Xcode, можно использовать _Interface Builder_ Xcode для создания и обслуживания пользовательских интерфейсов (или, при необходимости, создавать их непосредственно C# в коде).

XIB-файл используется macOS для определения элементов пользовательского интерфейса приложения (таких как меню, окна, представления, метки, текстовые поля), которые создаются и поддерживаются графически в Interface Builder Xcode.

[![Пример выполняющегося приложения](xib-images/intro01.png "Пример выполняющегося приложения")](xib-images/intro01-large.png#lightbox)

В этой статье рассматриваются основы работы с XIB-файлами в приложении Xamarin. Mac. Мы настоятельно рекомендуем сначала выполнить все инструкции по [Hello, Mac](~/mac/get-started/hello-mac.md) , так как в ней рассматриваются основные понятия и методы, которые мы будем использовать в этой статье.

Возможно, вы захотите ознакомиться с [ C# представлением классов и методов для цели-C](~/mac/internals/how-it-works.md) в документе о внутренних компонентах [Xamarin. Mac](~/mac/internals/how-it-works.md) , а также объясняются `Register` и `Export` атрибуты, используемые для подключения C# классов к цели-C. объекты и элементы пользовательского интерфейса.

## <a name="introduction-to-xcode-and-interface-builder"></a>Общие сведения об Xcode и конструкторе интерфейсов Interface Builder

В рамках Xcode компания Apple создала средство с именем Interface Builder, которое позволяет создавать пользовательский интерфейс визуально в конструкторе. Xamarin. Mac тесно интегрируется с Interface Builder, что позволяет создавать пользовательский интерфейс с теми же инструментами, что и целевые пользователи.

### <a name="components-of-xcode"></a>Компоненты Xcode

При открытии XIB-файла в Xcode из Visual Studio для Mac он открывается с помощью **навигатора по проектам** слева, **иерархии интерфейсов** и **редактора интерфейсов** в середине, а также в разделе **Свойства & Utilities** справа:

[![Компоненты пользовательского интерфейса Xcode](xib-images/xcode03.png "Компоненты пользовательского интерфейса Xcode")](xib-images/xcode03-large.png#lightbox)

Давайте посмотрим, что делает каждый из этих Xcode разделов и как они будут использоваться для создания интерфейса приложения Xamarin. Mac.

#### <a name="project-navigation"></a>Навигация по проекту

При открытии XIB-файла для редактирования в Xcode Visual Studio для Mac создает файл проекта Xcode в фоновом режиме для обмена изменениями между самим собой и Xcode. Позже при переключении обратно на Visual Studio для Mac из Xcode все изменения, внесенные в этот проект, синхронизируются с проектом Xamarin. Mac, Visual Studio для Mac.

Раздел **Навигация по проекту** позволяет перемещаться между всеми файлами, которые составляют этот проект Xcode _оболочки совместимости_ . Как правило, вас интересует только XIB файлы в этом списке, такие как **MainMenu. XIB** и **MainWindow. XIB**.

#### <a name="interface-hierarchy"></a>Иерархия интерфейса

Раздел **Иерархия интерфейса** позволяет легко получить доступ к нескольким ключевым свойствам пользовательского интерфейса, таким как **заполнители** и главное **окно**. Этот раздел также можно использовать для доступа к отдельным элементам (представлениям), которые составляют пользовательский интерфейс, и настраивать способ их вложенности, перетаскивая их в пределах иерархии.

#### <a name="interface-editor"></a>Редактор интерфейса

В разделе **Редактор интерфейсов** представлена поверхность, на которой можно графически разформатировать пользовательский интерфейс. Чтобы создать проект, перетащите элементы из раздела **Библиотека** в разделе **Свойства & служебные программы** . При добавлении элементов пользовательского интерфейса (представлений) в область конструктора они будут добавлены в раздел **Иерархия интерфейсов** в том порядке, в котором они отображаются в **редакторе интерфейса**.

#### <a name="properties--utilities"></a>Свойства & служебные программы

Раздел " **свойства & служебных программ** " делится на два основных раздела, с которыми мы будем работать, **свойствами** (также называемыми инспекторами) и **библиотекой**:

![Инспектор свойств](xib-images/xcode04.png "Инспектор свойств")

Изначально этот раздел почти пуст, однако если выбрать элемент в **редакторе интерфейса** или **иерархии интерфейса**, раздел **свойств** будет заполнен сведениями о заданном элементе и свойствах, которые можно становк.

В разделе **Свойства** находится восемь разных *вкладок инспекторов*, как показано на следующем рисунке:

[![Обзор всех инспекторов](xib-images/xcode05.png "Обзор всех инспекторов")](xib-images/xcode05-large.png#lightbox)

Слева направо располагаются следующие вкладки:

- **Инспектор файлов.** Инспектор файлов отображает сведения о файле, такие как имя файла и расположение редактируемого XIB-файла.
- **Экспресс-справка.** На вкладке "Экспресс-справка" содержится контекстная справка по компоненту или функции, выбранной в Xcode.
- **Инспектор удостоверений.** Инспектор удостоверений предоставляет сведения о выбранном элементе управления или представлении.
- **Инспектор атрибутов** — инспектор атрибутов позволяет настраивать различные атрибуты выбранного элемента управления или представления.
- **Инспектор размеров** — Инспектор размеров позволяет управлять размером и изменением размера выбранного элемента управления или представления.
- **Инспектор подключений** — в инспекторе подключений отображаются подключения к розеткам и действиям выбранных элементов управления. Мы рассмотрим все операции и действия чуть позже.
- **Инспектор привязок** — инспектор привязок позволяет настраивать элементы управления таким образом, чтобы их значения автоматически привязываются к моделям данных.
- **Инспектор эффектов просмотра** — инспектор эффектов представления позволяет задавать эффекты для элементов управления, например анимации.

В разделе **Library** можно найти элементы управления и объекты, помещаемые в конструктор для графического построения пользовательского интерфейса:

![Пример инспектора библиотек](xib-images/xcode06.png "Пример инспектора библиотек")

Теперь, когда вы знакомы с интегрированной средой разработки Xcode и Interface Builder, рассмотрим ее использование для создания пользовательского интерфейса.

## <a name="creating-and-maintaining-windows-in-xcode"></a>Создание и обслуживание Windows в Xcode

Предпочтительным способом создания пользовательского интерфейса приложения Xamarin. Mac является Раскадровка (Дополнительные сведения см. в документации по [раскадровкам](~/mac/platform/storyboards/index.md) ). в результате все новые проекты, запущенные в Xamarin. Mac, будут использовать раскадровки, параметры.

Чтобы перейти к использованию пользовательского интерфейса на основе XIB, выполните следующие действия.

1. Откройте Visual Studio для Mac и запустите новый проект Xamarin. Mac.
2. В **панель решения**щелкните правой кнопкой мыши проект и выберите **Добавить**  > **новый файл...**
3. Выберите **Mac**  > **контроллер Windows**:

    ![Добавление нового контроллера окна](xib-images/setup00.png "Добавление нового контроллера окна")
4. Введите `MainWindow` для имени и нажмите кнопку **New (создать** ):

    ![Добавление нового главного окна](xib-images/setup01.png "Добавление нового главного окна")
5. Еще раз щелкните проект правой кнопкой мыши и выберите **добавить**  > **новый файл...**
6. Выберите  > **главного меню** **Mac** :

    ![Добавление нового главного меню](xib-images/setup02.png "Добавление нового главного меню")
7. Оставьте имя `MainMenu` и нажмите кнопку **создать** .
8. В **панель решения** выберите файл **Main. Storyboard** , щелкните его правой кнопкой мыши и выберите **Удалить**:

    ![Выбор основной раскадровки](xib-images/setup03.png "Выбор основной раскадровки")
9. В диалоговом окне Удалить нажмите кнопку **Удалить** :

    ![Подтверждение удаления](xib-images/setup04.png "Подтверждение удаления")
10. В **панель решения**дважды щелкните файл **info. plist** , чтобы открыть его для редактирования.
11. Выберите `MainMenu` в раскрывающемся списке **главного интерфейса** :

    [![Настройка главного меню](xib-images/setup05.png "Настройка главного меню")](xib-images/setup05-large.png#lightbox)
12. В **панель решения**дважды щелкните файл **MainMenu. XIB** , чтобы открыть его для редактирования в interface Builderе Xcode.
13. В **инспекторе библиотек**введите `object` в поле поиска, а затем перетащите новый **объект** в область конструктора:

    [![Изменение главного меню](xib-images/setup06.png "Изменение главного меню")](xib-images/setup06-large.png#lightbox)
14. В **инспекторе удостоверений**введите `AppDelegate` для **класса**:

    [![Выбор делегата приложения](xib-images/setup07.png "Выбор делегата приложения")](xib-images/setup07-large.png#lightbox)
15. Выберите **владелец файла** в **иерархии интерфейс**, переключитесь в **инспектор подключений** и перетащите строку из делегата в **объект** `AppDelegate`, только что добавлен в проект:

    [![Подключение делегата приложения](xib-images/setup08.png "Подключение делегата приложения")](xib-images/setup08-large.png#lightbox)
16. Сохраните изменения и вернитесь в Visual Studio для Mac.

После внесения всех этих изменений измените файл **AppDelegate.CS** и сделайте его следующим:

```csharp
using AppKit;
using Foundation;

namespace MacXib
{
    [Register ("AppDelegate")]
    public class AppDelegate : NSApplicationDelegate
    {
        public MainWindowController mainWindowController { get; set; }

        public AppDelegate ()
        {
        }

        public override void DidFinishLaunching (NSNotification notification)
        {
            // Insert code here to initialize your application
            mainWindowController = new MainWindowController ();
            mainWindowController.Window.MakeKeyAndOrderFront (this);
        }

        public override void WillTerminate (NSNotification notification)
        {
            // Insert code here to tear down your application
        }
    }
}
```

Теперь главное окно приложения определяется в файле **. XIB** , которое автоматически включается в проект при добавлении контроллера окна. Чтобы изменить структуру Windows, в **панель решения**дважды щелкните файл **MainWindow. XIB** :

![Выбор файла MainWindow. XIB](xib-images/edit01.png "Выбор файла MainWindow. XIB")

Это приведет к открытию структуры окна в Interface Builder Xcode:

[![Изменение файла MainWindow. XIB](xib-images/edit02.png "Изменение файла MainWindow. XIB")](xib-images/edit02-large.png#lightbox)

### <a name="standard-window-workflow"></a>Рабочий процесс стандартного окна

Для любого окна, которое вы создаете и работаете с приложением Xamarin. Mac, процесс по сути такой же:

1. Для новых окон, которые не добавляются в проект автоматически по умолчанию, добавьте в проект новое определение окна.
2. Дважды щелкните файл XIB, чтобы открыть конструктор окон для редактирования в Interface Builder Xcode.
3. Задайте необходимые свойства окна в **инспекторе атрибутов** и **Инспекторе размеров**.
4. Перетащите элементы управления, необходимые для создания интерфейса, и настройте их в **инспекторе атрибутов**.
5. Используйте **Инспектор размеров** для изменения размера элементов пользовательского интерфейса.
6. Предоставление элементов пользовательского интерфейса окна коду с C# помощью розеток и действий.
7. Сохраните изменения и вернитесь в Visual Studio для Mac для синхронизации с Xcode.

### <a name="designing-a-window-layout"></a>Разработка макета окна

Процесс размещения пользовательского интерфейса в конструкторе Interface в основном одинаков для каждого добавляемого элемента:

1. Найдите нужный элемент управления в **инспекторе библиотек** и перетащите его в **Редактор интерфейса** и разместите его.
2. Задайте необходимые свойства окна в **инспекторе атрибутов**.
3. Используйте **Инспектор размеров** для изменения размера элементов пользовательского интерфейса.
4. Если вы используете пользовательский класс, задайте его в **инспекторе удостоверений**.
5. Предоставление элементам пользовательского интерфейса доступа C# к коду с помощью розеток и действий.
6. Сохраните изменения и вернитесь в Visual Studio для Mac для синхронизации с Xcode.

Пример.

1. В Xcode перетащите **нажимную кнопку**  из **раздела "Библиотека"** :

    [![Выбор кнопки из библиотеки](xib-images/xcode07.png "Выбор кнопки из библиотеки")](xib-images/xcode07-large.png#lightbox)
2. Перетащите кнопку на **окно** в **редакторе интерфейса**:

    [![Добавление кнопки в окно](xib-images/xcode08.png "Добавление кнопки в окно")](xib-images/xcode08-large.png#lightbox)
3. Щелкните свойство **Название** в **инспекторе атрибутов** и измените название кнопки на `Click Me`:

    ![Задание атрибутов кнопки](xib-images/xcode09.png "Задание атрибутов кнопки")
4. Перетащите **метку** из **раздела "Библиотека"** :

    [![Выбор метки в библиотеке](xib-images/xcode10.png "Выбор метки в библиотеке")](xib-images/xcode10-large.png#lightbox)
5. Поместите метку в область **Окно** рядом с кнопкой в **редакторе интерфейса**:

    [![Добавление метки в окно](xib-images/xcode11.png "Добавление метки в окно")](xib-images/xcode11-large.png#lightbox)
6. Захватите правый маркер метки и перетаскивайте его до границы окна:

    [![Изменение размера метки](xib-images/xcode12.png "Изменение размера метки")](xib-images/xcode12-large.png#lightbox)
7. Если метка по-прежнему выбрана в **редакторе интерфейса**, переключитесь в **инспектор размера**:

    ![Выбор инспектора размеров](xib-images/xcode13.png "Выбор инспектора размеров")
8. В **поле Автоподбор размера** щелкните **красную квадратную скобку** справа и **приглушенную красную горизонтальную стрелку** в центре:

    ![Изменение свойств автоподбора размера](xib-images/xcode14.png "Изменение свойств автоподбора размера")
9. Это гарантирует, что при изменении размера окна в работающем приложении метка будет перетягиваться на увеличение и уменьшение. **Красные квадратные скобки** , а также верхняя и левая часть поля с **полем автоподбора** указывают, что метка будет зависнуть в заданные расположения X и Y.
10. Сохранение изменений в пользовательском интерфейсе

По мере изменения размера и перемещения элементов управления следует заметить, что Interface Builder предоставляет полезные подсказки по использованию, основанные на [рекомендациях по управлению интерфейсом OS X](https://developer.apple.com/library/mac/documentation/UserExperience/Conceptual/OSXHIGuidelines/). Эти рекомендации помогут вам создать высококачественные приложения, которые будут иметь привычный вид для пользователей Mac.

Если взглянуть на раздел **Иерархия интерфейсов** , обратите внимание на то, как отображается макет и иерархия элементов, составляющих пользовательский интерфейс.

![Выбор элемента в иерархии интерфейсов](xib-images/xcode15.png "Выбор элемента в иерархии интерфейсов")

Здесь можно выбрать элементы для изменения или перетащить, чтобы изменить порядок элементов пользовательского интерфейса при необходимости. Например, если элемент пользовательского интерфейса был охвачен другим элементом, можно перетащить его в нижнюю часть списка, чтобы сделать его самым верхним элементом в окне.

Дополнительные сведения о работе с Windows в приложении Xamarin. Mac см. в документации по [Windows](~/mac/user-interface/window.md) .

## <a name="exposing-ui-elements-to-c-code"></a>Предоставление C# коду элементов пользовательского интерфейса

Завершив проектирование внешнего вида пользовательского интерфейса в Interface Builder, необходимо предоставить элементы пользовательского интерфейса, чтобы к ним можно было получить доступ из C# кода. Для этого вы будете использовать действия и возможности.

### <a name="setting-a-custom-main-window-controller"></a>Настройка пользовательского основного контроллера окна

Чтобы иметь возможность создавать розетки и действия для предоставления элементов пользовательского интерфейса C# коду, приложению Xamarin. Mac потребуется пользовательский контроллер окна.

Выполните следующие действия:

1. Откройте раскадровку приложения в Interface Builder Xcode.
2. Выберите `NSWindowController` в область конструктора.
3. Перейдите в представление **инспектора удостоверений** и введите `WindowController` в качестве **имени класса**:

    [![Изменение имени класса](xib-images/windowcontroller01.png "Изменение имени класса")](xib-images/windowcontroller01-large.png#lightbox)
4. Сохраните изменения и вернитесь в Visual Studio для Mac для синхронизации.
5. Файл **WindowController.CS** будет добавлен в проект **панель решения** в Visual Studio для Mac:

    ![Новое имя класса в Visual Studio для Mac](xib-images/windowcontroller02.png "Новое имя класса в Visual Studio для Mac")
6. Повторно откройте раскадровку в Interface Builder Xcode.
7. Файл **виндовконтроллер. h** будет доступен для использования:

    [![Соответствующий h файл в Xcode](xib-images/windowcontroller03.png "Соответствующий h файл в Xcode")](xib-images/windowcontroller03-large.png#lightbox)

### <a name="outlets-and-actions"></a>Розетки и действия

Итак, что такое возможности и действия? В традиционном программировании пользовательского интерфейса .NET добавляемый элемент управления в пользовательском интерфейсе автоматически предоставляется как свойство. В Mac это работает по-другому — простое добавление элемента управления в представление не делает его доступным для кода. Необходимо явно предоставить элемент пользовательского интерфейса в код. Для этого компания Apple предоставляет два варианта:

- **Переменные экземпляров.** Они аналогичны свойствам. Если вы подключаете элемент управления к розетке, он предоставляется коду через свойство, что позволяет выполнять такие действия, как присоединение обработчиков событий, вызов методов и т. д.
- **Действия.** Они аналогичны командам в WPF. Например, при выполнении действия над элементом управления, скажем нажатии кнопки, элемент управления будет автоматически вызывать метод в коде. Действия являются мощным и удобным, поскольку вы можете связать множество элементов управления с одним действием.

В Xcode операции и действия добавляются непосредственно в коде с помощью *перетаскивания элементов управления*. В частности, это означает, что для создания розетки или действия необходимо выбрать элемент управления, который вы хотите добавить к розетке или действию, удерживая нажатой кнопку **управления** на клавиатуре и перетащив этот элемент управления непосредственно в код.

Для разработчиков Xamarin. Mac это означает, что вы перетащили в файлы заглушки цели-C, которые C# соответствуют файлу, в котором нужно создать розетку или действие. Visual Studio для Mac создал файл с именем **MainWindow. h** в составе проекта Xcode оболочки, созданного для использования Interface Builder:

[![Пример h-файла в Xcode](xib-images/xcode16.png "Пример h-файла в Xcode")](xib-images/xcode16-large.png#lightbox)

Этот файл заглушки. h отражает **MainWindow.Designer.CS** , который автоматически добавляется в проект Xamarin. Mac при создании нового `NSWindow`. Этот файл будет использоваться для синхронизации изменений, внесенных Interface Builder, и здесь будут созданы ваши розетки и действия, чтобы элементы пользовательского интерфейса были доступны C# коду.

#### <a name="adding-an-outlet"></a>Добавление розетки

Имея базовое представление о том, что представляют собой возможности и действия, давайте рассмотрим создание розетки, чтобы предоставить элемент пользовательского интерфейса C# коду.

Выполните следующие действия:

1. В Xcode в правом верхнем углу экрана нажмите кнопку с изображением **двойного круга**, чтобы открыть **вспомогательный редактор**:

    [![Выбор редактора помощника](xib-images/outlet01.png "Выбор редактора помощника")](xib-images/outlet01-large.png#lightbox)
2. Xcode переключится в комбинированный режим, где в одной стороне находится **редактор интерфейса**, а в другой — **редактор кода**.
3. Обратите внимание, что Xcode автоматически выбрал файл **маинвиндовконтроллер. m** в **редакторе кода**, что является неправильным. Если вы не помните о том, какие розетки и действия находятся выше, необходимо выбрать файл **MainWindow. h** .
4. В верхней части **редактора кода** щелкните **автоматически ссылку** и выберите файл **MainWindow. h** :

    [![Выбор правильного файла. h](xib-images/outlet02.png "Выбор правильного файла. h")](xib-images/outlet02-large.png#lightbox)
5. Теперь в Xcode должен быть выбран правильный файл:

    [![Выбран правильный файл](xib-images/outlet03.png "Выбран правильный файл")](xib-images/outlet03-large.png#lightbox)
6. **Последнее действие было очень важным!** Если нужный файл не выбран, вы не сможете создавать розетки и действия, или они будут предоставлены неправильному классу в C#!
7. В **редакторе интерфейса**удерживайте нажатой клавишу **CTRL** на клавиатуре и перетащите метку, созданную выше, в редактор кода сразу под кодом `@interface MainWindow : NSWindow { }`:

    [![Перетаскивание для создания новой розетки](xib-images/outlet04.png "Перетаскивание для создания новой розетки")](xib-images/outlet04-large.png#lightbox)
8. Откроется диалоговое окно. Оставьте **Подключение** установленным в розетке и введите `ClickedLabel` для **имени**:

    [![Задание свойств розетки](xib-images/outlet05.png "Задание свойств розетки")](xib-images/outlet05-large.png#lightbox)
9. Нажмите кнопку " **подключить** ", чтобы создать розетку:

    ![Завершенная розетка](xib-images/outlet06.png "Завершенная розетка")
10. Сохраните изменения в файле.

#### <a name="adding-an-action"></a>Добавление действия

Теперь рассмотрим создание действия, чтобы предоставить пользователю взаимодействие с элементом пользовательского интерфейса в C# коде.

Выполните следующие действия:

1. Убедитесь, что все еще находится в **редакторе помощника** , а файл **MainWindow. h** отображается в **редакторе кода**.
2. В **редакторе интерфейса**удерживайте нажатой клавишу **CTRL** на клавиатуре и перетащите кнопку, созданную выше, в редактор кода сразу под кодом `@property (assign) IBOutlet NSTextField *ClickedLabel;`:

    [![Перетаскивание для создания действия](xib-images/action01.png "Перетаскивание для создания действия")](xib-images/action01-large.png#lightbox)
3. Измените тип **подключения** на действие:

    [![Выберите тип действия](xib-images/action02.png "Выберите тип действия")](xib-images/action02-large.png#lightbox)
4. Введите `ClickedButton` в поле **Имя**:

    [![Настройка действия](xib-images/action03.png "Настройка действия")](xib-images/action03-large.png#lightbox)
5. Нажмите кнопку **подключить** , чтобы создать действие:

    ![Завершенное действие](xib-images/action04.png "Завершенное действие")
6. Сохраните изменения в файле.

После того, как пользовательский интерфейс разXcode и предоставляется C# коду, переключитесь обратно на Visual Studio для Mac и позвольте ему синхронизировать изменения из и Interface Builder.

### <a name="writing-the-code"></a>Написание кода

После создания пользовательского интерфейса и его элементов пользовательского интерфейса, доступных для кода с помощью розеток и действий, можно приступать к написанию кода для обеспечения жизни программы. Например, откройте файл **MainWindow.CS** для редактирования, дважды щелкнув его в **панель решения**:

[![Файл MainWindow.cs](xib-images/code01.png "Файл MainWindow.cs")](xib-images/code01-large.png#lightbox)

И добавьте следующий код в класс `MainWindow` для работы с образцом выхода, созданным ранее:

```csharp
private int numberOfTimesClicked = 0;
...

public override void AwakeFromNib ()
{
    base.AwakeFromNib ();

    // Set the initial value for the label
    ClickedLabel.StringValue = "Button has not been clicked yet.";
}
```

Обратите внимание, что доступ к C# `NSLabel` осуществляется по непосредственному имени, которое вы назначили в Xcode при создании розетки в Xcode, в данном случае она называется `ClickedLabel`. Можно получить доступ к любому методу или свойству предоставленного объекта так же, как и C# к любому обычному классу.

> [!IMPORTANT]
> Необходимо использовать `AwakeFromNib`, а не другой метод, например `Initialize`, так как `AwakeFromNib` вызывается _после_ загрузки ОС и создания экземпляра пользовательского интерфейса из XIB-файла. Если вы попытались получить доступ к элементу управления Label до того, как файл. XIB будет полностью загружен и создан, возникнет ошибка `NullReferenceException`, так как элемент управления "метка" еще не создавался.

Затем добавьте следующий разделяемый класс в класс `MainWindow`:

```csharp
partial void ClickedButton (Foundation.NSObject sender) {

    // Update counter and label
    ClickedLabel.StringValue = string.Format("The button has been clicked {0} time{1}.",++numberOfTimesClicked, (numberOfTimesClicked < 2) ? "" : "s");
}
```

Этот код прикрепляется к действию, созданному в Xcode, и Interface Builder и будет вызываться каждый раз, когда пользователь нажмет кнопку.

Некоторые элементы пользовательского интерфейса автоматически имеют встроенные действия, например элементы в строке меню по умолчанию, такие как **Open...** menu (`openDocument:`). В **панель решения**дважды щелкните файл **AppDelegate.CS** , чтобы открыть его для редактирования, и добавьте следующий код под методом `DidFinishLaunching`:

```csharp
[Export ("openDocument:")]
void OpenDialog (NSObject sender)
{
    var dlg = NSOpenPanel.OpenPanel;
    dlg.CanChooseFiles = false;
    dlg.CanChooseDirectories = true;

    if (dlg.RunModal () == 1) {
        var alert = new NSAlert () {
            AlertStyle = NSAlertStyle.Informational,
            InformativeText = "At this point we should do something with the folder that the user just selected in the Open File Dialog box...",
            MessageText = "Folder Selected"
        };
        alert.RunModal ();
    }
}
```

Ключевой строкой здесь является `[Export ("openDocument:")]`, она сообщает `NSMenu`, что у **AppDelegate** есть метод `void OpenDialog (NSObject sender)`, отвечающий на действие `openDocument:`.

Дополнительные сведения о работе с меню см. в документации по [меню](~/mac/user-interface/menu.md) .

## <a name="synchronizing-changes-with-xcode"></a>Синхронизация изменений с Xcode

При переключении обратно на Visual Studio для Mac из Xcode все изменения, внесенные в Xcode, будут автоматически синхронизированы с проектом Xamarin. Mac.

Если вы выберете **MainWindow.Designer.CS** в **панель решения** вы сможете увидеть, как розетка и действия были привязаны в нашем C# коде:

[![Синхронизация изменений с Xcode](xib-images/sync01.png "Синхронизация изменений с Xcode")](xib-images/sync01-large.png#lightbox)

Обратите внимание на то, как два определения в файле **MainWindow.Designer.CS** :

```csharp
[Outlet]
AppKit.NSTextField ClickedLabel { get; set; }

[Action ("ClickedButton:")]
partial void ClickedButton (Foundation.NSObject sender);
```

Выровнять с определениями в файле **MainWindow. h** в Xcode:

```objc
@property (assign) IBOutlet NSTextField *ClickedLabel;
- (IBAction)ClickedButton:(id)sender;
```

Как видите, Visual Studio для Mac прослушивает изменения в h файле, а затем автоматически синхронизирует эти изменения в соответствующем **Designer.CS** файле, чтобы предоставить их приложению. Также можно заметить, что **MainWindow.Designer.CS** является разделяемым классом, поэтому Visual Studio для Mac не нужно изменять **MainWindow.CS** , который перезапишет все изменения, внесенные в класс.

Обычно вам никогда не придется открывать **MainWindow.Designer.CS** самостоятельно, он был представлен здесь только для образовательных целей.

> [!IMPORTANT]
> В большинстве случаев Visual Studio для Mac автоматически увидит все изменения, внесенные в Xcode, и синхронизирует их с проектом Xamarin. Mac. В ситуации, если синхронизация не выполняется автоматически, вернитесь в Xcode и еще раз вернитесь в Visual Studio для Mac. Обычно эти действия запускают цикл синхронизации.

## <a name="adding-a-new-window-to-a-project"></a>Добавление нового окна в проект

Помимо главного окна документа, приложению Xamarin. Mac может потребоваться отобразить другие типы окон, например настройки или панели инспектора. При добавлении нового окна в проект всегда следует использовать **окно Cocoa с** параметром Controller, так как это позволяет упростить загрузку окна из XIB-файла.

Чтобы добавить новое окно, выполните следующие действия.

1. В **панель решения**щелкните правой кнопкой мыши проект и выберите **Добавить**  > **новый файл..** .
2. В диалоговом окне новый файл выберите **Xamarin. Mac**  > **окно Cocoa с контроллером**:

    ![Добавление нового контроллера окна](xib-images/new01.png "Добавление нового контроллера окна")
3. Введите в поле **Имя** значение `PreferencesWindow` и нажмите кнопку **Новый**.
4. Дважды щелкните файл **преференцесвиндов. XIB** , чтобы открыть его для редактирования в Interface Builder:

    [![Изменение окна в Xcode](xib-images/new02.png "Изменение окна в Xcode")](xib-images/new02-large.png#lightbox)
5. Проектирование интерфейса:

    [![Проектирование макета Windows](xib-images/new03.png "Проектирование макета Windows")](xib-images/new03-large.png#lightbox)
6. Сохраните изменения и вернитесь в Visual Studio для Mac для синхронизации с Xcode.

Добавьте следующий код в **AppDelegate.CS** , чтобы отобразить новое окно:

```csharp
[Export("applicationPreferences:")]
void ShowPreferences (NSObject sender)
{
    var preferences = new PreferencesWindowController ();
    preferences.Window.MakeKeyAndOrderFront (this);
}
```

@No__t_0ная строка создает новый экземпляр контроллера окна, который загружает окно из XIB-файла и расширяет его. В `preferences.Window.MakeKeyAndOrderFront (this);` строке отображается новое окно для пользователя.

Если запустить код и выбрать **Параметры...** в **меню приложение**, откроется окно:

![Запуск примера приложения](xib-images/new04.png "Запуск примера приложения")

Дополнительные сведения о работе с Windows в приложении Xamarin. Mac см. в документации по [Windows](~/mac/user-interface/window.md) .

## <a name="adding-a-new-view-to-a-project"></a>Добавление нового представления в проект

Иногда бывает проще разбить структуру окна на несколько более управляемых файлов XIB. Например, можно переключать содержимое главного окна при выборе элемента панели инструментов в **окне «настройки** » или при переключении содержимого в ответ на выбор **исходного списка** .

При добавлении нового представления в проект всегда следует использовать параметр **Cocoa View with Controller** , так как в этом случае процесс загрузки представления из XIB-файла упрощается.

Чтобы добавить новое представление, выполните следующие действия.

1. В **панель решения**щелкните правой кнопкой мыши проект и выберите **Добавить**  > **новый файл..** .
2. В диалоговом окне новый файл выберите **Xamarin. Mac**  > **представление Cocoa с контроллером**:

    ![Добавление нового представления](xib-images/view01.png "Добавление нового представления")
3. Введите в поле **Имя** значение `SubviewTable` и нажмите кнопку **Новый**.
4. Дважды щелкните файл **субвиевтабле. XIB** , чтобы открыть его для редактирования в Interface Builder и разработать пользовательский интерфейс:

    [![Проектирование нового представления в Xcode](xib-images/view02.png "Проектирование нового представления в Xcode")](xib-images/view02-large.png#lightbox)
5. Подпишите все необходимые действия и розетки.
6. Сохраните изменения и вернитесь в Visual Studio для Mac для синхронизации с Xcode.

Затем измените **SubviewTable.CS** и добавьте следующий код в файл **авакефромниб** , чтобы заполнить новое представление при его загрузке:

```csharp
public override void AwakeFromNib ()
{
    base.AwakeFromNib ();

    // Create the Product Table Data Source and populate it
    var DataSource = new ProductTableDataSource ();
    DataSource.Products.Add (new Product ("Xamarin.iOS", "Allows you to develop native iOS Applications in C#"));
    DataSource.Products.Add (new Product ("Xamarin.Android", "Allows you to develop native Android Applications in C#"));
    DataSource.Products.Add (new Product ("Xamarin.Mac", "Allows you to develop Mac native Applications in C#"));
    DataSource.Sort ("Title", true);

    // Populate the Product Table
    ProductTable.DataSource = DataSource;
    ProductTable.Delegate = new ProductTableDelegate (DataSource);

    // Auto select the first row
    ProductTable.SelectRow (0, false);
}
```

Добавьте в проект перечисление для наблюдения за отображаемым в данный момент представлением. Например, **SubviewType.CS**:

```csharp
public enum SubviewType
{
    None,
    TableView,
    OutlineView,
    ImageView
}
```

Измените файл XIB в окне, который будет использовать представление и отобразит его. Добавьте **пользовательское представление** , которое будет действовать в качестве контейнера для представления после его загрузки в память с помощью C# кода и предоставления его розетке, именуемой `ViewContainer`:

[![Создание требуемой розетки](xib-images/view03.png "Создание требуемой розетки")](xib-images/view03-large.png#lightbox)

Сохраните изменения и вернитесь в Visual Studio для Mac для синхронизации с Xcode.

Затем измените файл CS в окне, в котором будет отображаться новое представление (например, **MainWindow.CS**), и добавьте следующий код:

```csharp
private SubviewType ViewType = SubviewType.None;
private NSViewController SubviewController = null;
private NSView Subview = null;
...

private void DisplaySubview(NSViewController controller, SubviewType type) {

    // Is this view already displayed?
    if (ViewType == type) return;

    // Is there a view already being displayed?
    if (Subview != null) {
        // Yes, remove it from the view
        Subview.RemoveFromSuperview ();

        // Release memory
        Subview = null;
        SubviewController = null;
    }

    // Save values
    ViewType = type;
    SubviewController = controller;
    Subview = controller.View;

    // Define frame and display
    Subview.Frame = new CGRect (0, 0, ViewContainer.Frame.Width, ViewContainer.Frame.Height);
    ViewContainer.AddSubview (Subview);
}
```

Когда нам нужно показать новое представление, загруженное из XIB-файла в контейнере окна ( **пользовательское представление** , добавленное выше), этот код обрабатывает удаление любого существующего представления и переводит его на новый. Будет отображено представление, которое уже отображается, если оно будет удалено с экрана. Затем он передается в представление, которое было передано (загруженное из контроллера представления), изменяет его размер, чтобы он поместился в область содержимого, и добавляет его в содержимое для отображения.

Чтобы отобразить новое представление, используйте следующий код:

```csharp
DisplaySubview(new SubviewTableController(), SubviewType.TableView);
```

При этом создается новый экземпляр контроллера представления для отображения нового представления, устанавливается его тип (как указано в перечислении, добавленном в проект) и используется метод `DisplaySubview`, добавленный в класс окна для фактического отображения представления. Пример:

[![Запуск примера приложения](xib-images/view04.png "Запуск примера приложения")](xib-images/view04-large.png#lightbox)

Дополнительные сведения о работе с Windows в приложении Xamarin. Mac см. в документации по [Windows](~/mac/user-interface/window.md) и [диалоговым окнам](~/mac/user-interface/dialog.md) .

## <a name="summary"></a>Сводка

В этой статье подробно рассматривается работа с файлами. XIB в приложении Xamarin. Mac. Мы видели различные типы и использование файлов. XIB для создания пользовательского интерфейса приложения, создания и сопровождения XIB-файлов в Interface Builder Xcode и работы с XIB-файлами в C# коде.

## <a name="related-links"></a>Связанные ссылки

- [MacImages (пример)](https://docs.microsoft.com/samples/xamarin/mac-samples/macimages)
- [Привет, Mac](~/mac/get-started/hello-mac.md)
- [Windows](~/mac/user-interface/window.md)
- [Меню](~/mac/user-interface/menu.md)
- [Диалоговые окна](~/mac/user-interface/dialog.md)
- [Работа с изображениями](~/mac/app-fundamentals/image.md)
- [Рекомендации по созданию пользовательских интерфейсов в macOS](https://developer.apple.com/macos/human-interface-guidelines/overview/themes/)
