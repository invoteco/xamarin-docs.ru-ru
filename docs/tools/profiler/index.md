---
title: Xamarin Profiler
description: В этом руководством рассматриваются основные функции Xamarin Profiler. Он рассматривает профилировщики, профилирование и время их использования, а также стандартный рабочий процесс для профилирования приложений Xamarin.
ms.prod: xamarin
ms.assetid: 3247fcee-6acc-470d-ab87-c1c511d67363
author: conceptdev
ms.author: crdun
ms.date: 06/03/2018
ms.openlocfilehash: 745c59ad50f0e8ad50a8ec56549d99b7b5e72228
ms.sourcegitcommit: 57f815bf0024b1afe9754c0e28054fc0a53ce302
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2019
ms.locfileid: "70772475"
---
# <a name="xamarin-profiler"></a>Xamarin Profiler

_В этом руководством рассматриваются основные функции Xamarin Profiler. Он рассматривает профилировщики, профилирование и время их использования, а также стандартный рабочий процесс для профилирования приложений Xamarin._

Успешное выполнение приложения зависит от взаимодействия с конечным пользователем. Как разработчик, возможно, вы реализовали в своем приложении некоторые действительно потрясающие функции, но если приложение работает медленно или завершается сбоем, пользователь, скорее всего, получит его.

Исторически, Mono предоставляет мощный профилировщик командной строки для сбора сведений о программах, выполняющихся в среде выполнения Mono, называемой [профилировщиком журнала Mono](https://www.mono-project.com/docs/debug+profile/profile/profiler/). Xamarin Profiler графический интерфейс для профилировщика журнала Mono и поддерживает профилирование приложений Android, iOS, tvOS и Mac в приложениях Mac, Android, iOS и tvOS в Windows.

В Xamarin Profiler доступно несколько инструментов для профилирования: выделений, циклов и профилировщика времени. В этом руководство рассматриваются возможности этих инструментов и анализ приложения, а также объясняется смысл данных, представленных на каждом экране.

В этом руководством рассматриваются распространенные сценарии профилирования и рассматривается профилировщик как средство, помогающее анализировать и оптимизировать приложения iOS и Android.

## <a name="download-and-install"></a>Скачать и установить

> [!NOTE]
> Необходимо быть подписчиком [Visual Studio Enterprise](https://visualstudio.microsoft.com/vs/compare/) , чтобы разблокировать эту функцию в Visual Studio Enterprise в Windows или Visual Studio для Mac на компьютере Mac.

Xamarin Profiler — это автономное приложение, интегрированное с Visual Studio для Mac и Visual Studio для включения профилирования из интегрированной среды разработки.

Скачайте пакет установки для своей платформы:

- [**macOS**](https://dl.xamarin.com/profiler/profiler-mac.pkg)
- [**Windows**](https://dl.xamarin.com/profiler/profiler-windows.msi)

После загрузки запустите установщик, чтобы добавить Xamarin Profiler в систему.

## <a name="profilers-and-profiling"></a>Профилировщики и профилирование

Профилирование — это важный и часто незнакомый шаг при разработке приложений. Профилирование представляет собой форму **динамического анализа программы** . она анализирует программу во время ее работы и используется. Профилировщик — это средство интеллектуального анализа данных, которое собирает сведения о сложности времени, использовании определенных методов и выделенной памяти. Профилировщик позволяет детализировать углублением и анализировать эти метрики, чтобы выявить проблемные области в коде.

При проектировании и разработке приложения важно не оптимизировать его преждевременно; Это значит, что тратит время на разработку кода в областях, к которым будет редко обращаться. Это сила профилирования. Профилировщик предоставляет подробные сведения о наиболее часто используемых частях кода и помогает искать области, в которых следует тратить время на внесение усовершенствований. Разработчики должны понимать, где большую часть времени тратится на ваше приложение, и как используется память приложением.

Профилирование полезно во всех типах разработки, но особенно важно при разработке мобильных приложений. Неоптимизированный код гораздо более заметен на мобильных платформах, чем на настольных компьютерах, и успешное выполнение приложения зависит от отличного и оптимизированного кода, который работает эффективно.

## <a name="xamarin-profiler"></a>Xamarin Profiler

Xamarin Profiler предоставляет разработчикам способ профилирования приложений в Visual Studio для Mac или Visual Studio. Профилировщик собирает и отображает сведения о приложении, которые затем могут использоваться разработчиком для анализа поведения приложения. Существует несколько способов профилирования приложения с помощью Xamarin Profiler, а именно "профилирование памяти" и "Статистическая выборка". Они выполняются с помощью инструментов выделения и профилировщика времени соответственно.

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

В настоящее время Xamarin Profiler можно использовать для тестирования приложений Xamarin. iOS, Xamarin. Android и Xamarin. Mac на компьютерах Mac (через Visual Studio для Mac). Профилировщик — это отдельный процесс из интегрированной среды разработки, поэтому в дополнение к запуску из Visual Studio для Mac его можно использовать в качестве автономного приложения для проверки exe-файла и `.mlpd` файлов, созданных из [профайлера журнала Mono](https://www.mono-project.com/docs/debug+profile/profile/profiler/).

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

В настоящее время Xamarin Profiler можно использовать для тестирования приложений Xamarin. Android в Windows (с помощью Visual Studio и Visual Studio для Mac). Профилировщик — это отдельный процесс из интегрированной среды разработки, поэтому в дополнение к запуску из Visual Studio его можно использовать в качестве автономного приложения для проверки exe-файлов и `.mlpd` , созданных из [профилировщика журнала Mono](https://www.mono-project.com/docs/debug+profile/profile/profiler/).

-----

<a name="Profiler_Support" />

## <a name="profiler-support"></a>Поддержка профилировщика

Поддержка Xamarin Profiler доступна на следующих платформах:

- Visual Studio для Mac (macOS с лицензией Enterprise)
  - Android
    - Устройство и эмулятор
  - iOS
    - Устройство и симулятор
  - tvOS (инструмент времени не поддерживается)
    - Устройство и симулятор
  - Mac

- Visual Studio (только **Корпоративная** версия)
  - Android
    - Устройство и эмулятор
  - iOS [экспериментальная версия]
    - Устройство и симулятор
  - tvOS
    - Устройство и симулятор

Обратите внимание, что можно профилировать **только** конфигурации **отладки** .

## <a name="profiler-basics"></a>Основы профилировщика

В этом разделе описываются части Xamarin Profiler и рассматриваются его функции.

### <a name="allow-profiling-in-your-app"></a>Разрешить профилирование в приложении

Прежде чем можно будет успешно выполнить профилирование приложения, необходимо разрешить профилирование в параметрах проекта приложения.

- iOS

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

  **Сборка > > отладки iOS Включение профилирования**

  ![Диалоговое окно параметров iOS в Visual Studio для Mac](images/ios-options-mac.png)

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

  **Свойства > > сборки iOS включить профилирование**

  ![Диалоговое окно параметров iOS в Visual Studio](images/ios-project-options-vs.png)

-----

- Android

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

  **Сборка > отладке Android > включить инструментирование для разработчиков**

  ![Диалоговое окно параметров Android в Visual Studio для Mac](images/android-project-options.png)

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

  **Сборка > отладке Android > включить инструментирование для разработчиков**

  ![Диалоговое окно параметров Android в Visual Studio для Mac](images/android-project-options-vs-sml.png)

-----

### <a name="launching-the-profiler"></a>Запуск профилировщика

Xamarin Profiler можно запустить из IDE при профилировании приложения iOS или Android или в качестве автономного приложения.

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

#### <a name="launching-from-visual-studio-for-mac"></a>Запуск из Visual Studio для Mac

1. Сначала убедитесь, что приложение загружено в Visual Studio для Mac, и выберите конфигурацию отладки (по умолчанию).
2. Перейдите к **выполнению > запустите профилирование**в Visual Studio для Mac или **проанализируйте > Xamarin Profiler** в Visual Studio, чтобы открыть профилировщик, как показано на схеме ниже.

  ![Запуск профилировщика из Visual Studio для Mac](images/start-profiling-xs.png)

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

#### <a name="launching-from-visual-studio"></a>Запуск из Visual Studio

1. Во-первых, убедитесь, что приложение загружено в Visual Studio, и выберите конфигурацию отладки (по умолчанию), как указано выше.
2. Перейдите к **анализу > Xamarin Profiler** в Visual Studio, чтобы открыть профилировщик, как показано на схеме ниже:

![Запуск профилировщика из Visual Studio](images/start-profiling-vs.png)

-----

Если пункты меню не отображаются, см. [руководство по устранению неполадок](~/tools/profiler/troubleshooting.md).

При этом запускается профилировщик и автоматически запускается профилирование приложения.

Профилировщик можно использовать для измерения объема памяти и производительности. Это достигается благодаря выделению и инструментам профилировщика времени, которые подробно рассматриваются в следующем разделе.

#### <a name="saving-and-loading-profiler-sessions"></a>Сохранение и загрузка сеансов профилировщика

Чтобы сохранить сеанс профилирования в любое время, выберите **файл > сохранить как...** в строке меню профилировщика. Этот файл сохраняется в формате _MLPD_ , а также в особо сжатом формате для данных профилирования.

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

После установки Xamarin Profiler можно найти в папке приложения, как показано на снимке экрана ниже:

![Открыть автономный профилировщик из Mac](images/applications.png)

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

После установки Xamarin Profiler приложение можно найти в каталоге приложения:

![Открыть автономный профилировщик из Windows](images/applications-vs.png)

-----

Файлы *. MLPD* можно загрузить в профилировщик, открыв автономное приложение, выбрав **пункт выбрать целевой объект** и загрузив файл.

Дополнительные сведения см. в разделе [Создание файлов. MLPD](~/tools/profiler/troubleshooting.md#gen_mlpd).

## <a name="profiler-features"></a>Функции профилировщика

Xamarin Profiler состоит из пяти разделов, как показано ниже.

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

[![Разделы профилировщика в Visual Studio для Mac](images/profiler-mac-sml.png)](images/profiler-mac.png#lightbox) 

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

[![Разделы профилировщика в Visual Studio](images/profiler-vs.png)](images/profiler-vs.png#lightbox)

-----

- **Панель инструментов** , расположенная в верхней части профилировщика, предлагает параметры для запуска и завершения профилирования, выбора целевого процесса, просмотра времени выполнения приложения и выбора разделенных представлений, образующих приложение профилировщика.
- **Список инструментов** — список всех инструментов, загруженных для сеанса профилирования.
- **Диаграмма графика** — эти диаграммы связаны по горизонтали с соответствующими инструментами в списке инструментов. Для изменения масштаба можно использовать ползунок (показанный ниже профилировщика времени).
- **Область сведений об инструменте** — содержит данные, отображаемые выбранным представлением текущего инструмента. Более подробно эти представления будут рассмотрены в разделе ниже.
- **Представление инспектора** — содержит разделы, которые можно выбрать с помощью сегментированного элемента управления. Разделы зависят от выбранного инструмента и включают: Параметры конфигурации, статистика, сведения о трассировке стека и путь к корням.

### <a name="allocations"></a>Выделения

Инструмент выделения предоставляет подробные сведения об объектах в приложении по мере их создания и сбора мусора.

В верхней части профилировщика находится диаграмма распределения, в которой отображается объем памяти, выделенной через равные промежутки времени во время профилирования. В настоящее время граф распределений — это общее количество выделений, а не размер кучи в данный момент времени. В определенном смысле он никогда не будет передвигаться вниз, но только когда-либо увеличится. Сюда относятся объекты, выделенные в стеке. В зависимости от используемой версии среды выполнения диаграмма может выглядеть по-разному, даже для того же приложения.

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

[![Инструмент выделения](images/allocations1.png)](images/allocations1.png#lightbox) 

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

[![Инструмент выделения](images/allocations1-vs.png)](images/allocations1-vs.png#lightbox)

-----

В инструменте выделения ресурсов существуют различные представления данных, позволяющие разработчикам анализировать использование и освобождение памяти в приложении. Ниже описаны эти представления.

- **Выделения** — отображает список всех выделений и группирует их по имени класса. Это предоставляет общий обзор используемых классов и методов, частоту их использования и общий размер используемых классов. Дважды щелкнув класс, вы увидите выделенную память: 

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

  [![Вкладка "выделения"](images/allocations3.png)](images/allocations3.png#lightbox) 

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

  [![Вкладка "выделения"](images/allocations2-vs.png)](images/allocations2-vs.png#lightbox)

-----

Представление инспектора для выделений предоставляет параметры для фильтрации и группирования объектов, предоставления статистики по выделенной памяти, а также представлений для трассировки стека и пути к корню.

- **Дерево вызовов** — отображает все дерево вызовов всех потоков в приложении и включает сведения о памяти, выделенной для каждого узла. При выборе элемента в списке все родственные узлы будут отображаться серым цветом. Можно развернуть дерево или дважды щелкнуть элемент, чтобы выполнить детализацию. При отображении этого представления данных можно использовать представление инспектора параметров отображения, чтобы изменить способ представления. В настоящее время существует два варианта:
    1. **Инвертированное дерево вызовов** — рассматривает трассировку стека сверху вниз. Это удобный вариант просмотра, так как он указывает самые глубокие методы, в которых ЦП тратит время.
    2. **Отдельно для потока** — этот параметр упорядочивает дерево вызовов по потоку.

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

  [![Вкладка "дерево вызовов"](images/allocations2.png)](images/allocations2.png#lightbox) 

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

  [![Вкладка "дерево вызовов"](images/allocations3-vs.png)](images/allocations3-vs.png#lightbox)

-----

- **Моментальные снимки** — в этой области отображаются сведения о моментальных снимках памяти. Чтобы создать их во время профилирования приложения в режиме реального времени, нажмите кнопку _камеры_ на панели инструментов в каждой точке, где вы хотели бы узнать, какой объем памяти будет храниться и освобождаться. Затем можно щелкнуть каждый снимок, чтобы узнать, что происходит внутри. Обратите внимание, что моментальные снимки могут быть сделаны только при интерактивном профилировании приложения. 

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

  [![Вкладка «моментальные снимки»](images/allocations4.png)](images/allocations4.png#lightbox) 

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

  [![Вкладка «моментальные снимки»](images/allocations4-vs.png)](images/allocations4-vs.png#lightbox)

-----

### <a name="time-profiler"></a>Профилировщик времени

Инструмент профилировщика времени измеряет точно то, сколько времени тратится на каждый метод приложения. Приложение приостанавливается через регулярные интервалы, а трассировка стека выполняется в каждом активном потоке. В каждой строке в области сведений об инструменте отображается выполненный путь выполнения.

Диаграмма графиков, как показано на снимке экрана ниже, отображает число выборок, полученных приложением при его запуске:

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

[![Инструментирование времени профилировщика](images/time1.png)](images/time1.png#lightbox) 

[![Инструментирование времени профилирования — список примеров](images/time3.png)](images/time3.png#lightbox) 

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

[![Инструментирование времени профилировщика](images/time1-vs.png)](images/time1-vs.png#lightbox) 

[![Инструментирование времени профилирования — список примеров](images/time3-vs.png)](images/time3-vs.png#lightbox) 

-----

- **Дерево вызовов** — показывает количество времени, затраченное на каждый метод:

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

  [![Средство профилирования времени — дерево вызовов](images/time2.png)](images/time2.png#lightbox) 

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

  [![Средство профилирования времени — дерево вызовов](images/time2-vs.png)](images/time2-vs.png#lightbox) 

-----

### <a name="cycles"></a>Циклы

Использование C# и F# управляемый код может быть довольно распространенным, и, увы, довольно просто создать ссылки на объекты, которые никогда не будут удалены. Этот инструмент позволяет точно определить эти объекты и отобразить циклы, на которые ссылается приложение.

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

[![Инструмент циклов](images/cycles.m751-sml.png)](images/cycles.m751.png#lightbox) 

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

[![Инструмент циклов](images/cycles-vs-sml.png)](images/cycles-vs.png#lightbox) 

-----

## <a name="profiling-applications"></a>Профилирование приложений

В настоящее время профилирование можно выполнять только для конфигураций отладки по умолчанию.

При профилировании приложения с любой другой конфигурацией отобразится следующее диалоговое окно сообщения:

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

[![Диалоговое окно ошибки профилирования](images/image001.png)](images/image001.png#lightbox) 

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

[![Диалоговое окно ошибки профилирования](images/image1vs.png)](images/image1vs.png#lightbox) 

-----

Чтобы продолжить, выберите **Обновить** .

### <a name="sgen-garbage-collector-and-profiling"></a>Сборщик мусора SGen и профилирование

Сборщик мусора [SGen](https://www.mono-project.com/docs/advanced/garbage-collector/sgen/) используется для всех платформ Xamarin.

SGen — это поколение GC, которое выделяет объекты приложения в три кучи — инкубатор, основную кучу и пространство больших объектов. Это позволяет спидиер выполнение сборки мусора. В настоящее время SGen является GC по умолчанию для приложений Xamarin. Android и Xamarin. iOS.

Приложение Xamarin. iOS, использующее Classic API Boehm GC — консервативный, не основанный на поколениях сборщик мусора. Так как это консервативный уровень, вероятность освобождения доступной памяти снижается, что может привести к неточным результатам при использовании профилировщика. По этой причине инструмент распределения нельзя использовать с сборщиком мусора Boehm.

Хотя будет выведено диалоговое окно с сообщением, если приложение использует Boehm GC, Xamarin не рекомендует переключать существующее приложение iOS, использующее Boehm, в SGen без тщательного исследования и тщательного тестирования. Xamarin также не рекомендует переключаться на SGen для профилирования, а затем переключаться обратно, так как эти результаты не обеспечивают точное тестирование использования памяти.

Дополнительные сведения об управлении памятью см. в статье рекомендации по [использованию памяти и производительности](~/cross-platform/deploy-test/memory-perf-best-practices.md) .

## <a name="summary"></a>Сводка

В этом руководство мы рассмотрели, что такое профилирование и как оно полезно для разработчика. Затем мы предоставили Xamarin Profiler, предоставляя некоторую историю и информацию о том, как она работает. Наконец, мы проучили функции Xamarin Profiler, а также изучим средства выделения и инструментирования временных файлов.

## <a name="related-links"></a>Связанные ссылки

- [Рекомендации по использованию памяти и производительности](~/cross-platform/deploy-test/memory-perf-best-practices.md)
- [Заметки о выпуске](https://github.com/xamarin/release-notes-archive/blob/master/release-notes/profiler/preview/index.md)
