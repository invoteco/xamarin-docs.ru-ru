---
title: Динамическая перезагрузка Xamarin (Предварительная версия)
description: См. раздел изменения в коде XAML, отраженный в реальном времени, без необходимости выполнения другой компиляции и развертывания.
ms.prod: xamarin
ms.assetid: 4917273d-32f9-401a-a52c-5cfb53a2170d
ms.technology: xamarin-forms
author: pierceboggan
ms.author: piboggan
robots: noindex
ms.date: 10/26/2018
ms.openlocfilehash: e6c8e7b84ba8e3d0f6e6247798bb9164a3bc994d
ms.sourcegitcommit: 8df67f0d76ff762b517d27b8d4c217d3a3379a18
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2020
ms.locfileid: "79423906"
---
# <a name="xamarin-live-reload-preview"></a>Динамическая перезагрузка Xamarin (Предварительная версия)

> [!NOTE]
> Предварительная версия динамической перезагрузки Xamarin закончилась, и мы хотим поблагодарить всех за ваши отзывы и комментарии. 
>
> Чтобы изменить XAML во время работы приложения, используйте [горячую перезагрузку XAML для Xamarin. Forms](~/xamarin-forms/xaml/hot-reload.md).
>

Перезагрузка Xamarin Live позволяет **вносить изменения в код XAML и видеть их в реальном времени, не требуя других компиляций и развертываний**. Любые изменения, внесенные в XAML, будут повторно развернуты при сохранении и отражены в целевом объекте развертывания.

## <a name="requirements"></a>Требования

* [Visual Studio 2017 версии 15,7 или более поздней](https://visualstudio.microsoft.com/vs/) с рабочей нагрузкой **для разработки мобильных приложений на .NET** .
* [Xamarin. Forms 3.0.0 или более поздней версии](https://www.nuget.org/packages/Xamarin.Forms/).

## <a name="getting-started"></a>Начало работы
### <a name="1-install-xamarin-live-reload-from-the-visual-studio-marketplace"></a>1. Установите динамическую перезагрузку Xamarin из Visual Studio Marketplace

Динамическая перезагрузка Xamarin распространяется с помощью Visual Studio Marketplace. Чтобы установить расширение, перейдите на [страницу "перезагрузка Xamarin Live" на](https://marketplace.visualstudio.com/items?itemName=Xamarin.XamarinLiveReload) веб-сайте Visual Studio Marketplace и нажмите кнопку " **скачать**".

Откройте загруженный VSIX-файл и нажмите кнопку **установить**.

![Подтверждение перезагрузки установщика Visual Studio Xamarin Live](images/LiveReloadVSIXInstall.png)

Кроме того, его можно найти на вкладке "в **сети** " в диалоговом окне " **расширения и обновления** " в Visual Studio.

### <a name="2-configure-your-app-to-use-live-reload"></a>2. Настройте приложение для использования динамической перезагрузки

Добавление динамической перезагрузки в существующие мобильные приложения может выполняться в три этапа:

1. Убедитесь, что все проекты обновлены для использования [Xamarin. Forms 3.0.0 или более](https://www.nuget.org/packages/Xamarin.Forms/) поздней или более поздней версии.

2. Добавьте пакет NuGet **Xamarin. LiveReload** :

    а. **.NET Standard** — установите NuGet **Xamarin. LiveReload** в библиотеку .NET Standard 2,0. Это не обязательно должно быть установлено в проектах платформы. Убедитесь, что для **источника пакета** задано значение **все**.
    
    б. **Общие проекты** — установите **Xamarin. LiveReload** NuGet во все проекты платформы (например, Android, iOS, UWP и т. д.). Убедитесь, что для **источника пакета** задано значение **все**.

    [![добавить пакет NuGet динамической загрузки Xamarin с помощью диспетчера пакетов NuGet](images/addlivereloadnuget.w157-sml.png)](images/addlivereloadnuget.w157.png#lightbox)

3. Добавьте `LiveReload.Init();` в конструктор класса `Application`, как показано в следующем фрагменте кода:

```csharp
public partial class App : Application
{
    public App ()
    {
        // Initialize Live Reload.
        #if DEBUG
        LiveReload.Init();
        #endif
        
        InitializeComponent();
        MainPage = new MainPage();
    }
}
```

### <a name="3-start-live-reloading"></a>3. Запустите динамическую перезагрузку

Скомпилируйте и разверните приложение. После развертывания приложения откройте XAML-файл, внесите некоторые изменения и сохраните файл. Изменения будут повторно развернуты в целевом объекте развертывания.

> [!Video https://www.youtube.com/embed/-5WJZpeXlC8]

Динамическая перезагрузка работает с изменениями в любом файле XAML. Чтобы изменения C# или добавления или удаления пакетов NuGet вступили в силу, требуется новая сборка и развертывание.

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы 
### <a name="is-xamarin-live-reload-available-on-visual-studio-for-mac"></a>Доступна ли перезагрузка Xamarin Live на Visual Studio для Mac? 

Нет, предварительная версия окончательной перезагрузки Xamarin доступна только для Visual Studio 2017.

### <a name="does-this-work-with-all-libraries-such-as-prism"></a>Работает ли эта работа со всеми библиотеками, такими как Prism? 

Так как приложение скомпилировано, динамическая перезагрузка работает со всеми библиотеками, такими как Prism, и сторонними библиотеками элементов управления, такими как Telerik, Infragistics, Syncfusion, ArcGIS, ГрапеЦити и другие поставщики элементов управления.

### <a name="what-changes-does-live-reload-redeploy"></a>Какие изменения выполняет повторную перезагрузку повторно? 

Динамическая перезагрузка применяет только изменения, внесенные в XAML или CSS. При внесении изменений в C# файл потребуется выполнить повторную компиляцию. 

### <a name="what-platforms-are-supported"></a>Какие платформы поддерживаются? 

Динамическая перезагрузка работает на любой платформе, поддерживаемой Xamarin. Forms, включая Android, iOS и UWP.

### <a name="does-this-work-on-emulators-simulators-and-physical-devices"></a>Работает ли эта работа с эмуляторами, симуляторами и физическими устройствами? 

Да, динамическая перезагрузка работает со всеми допустимыми целями развертывания, включая эмуляторы Android, Симуляторы iOS и физические устройства. Для развертывания на устройстве требуется, чтобы устройство и компьютер были в одной сети Wi-Fi.

### <a name="does-this-work-with-corporate-networks"></a>Работает ли эта работа с корпоративными сетями?

При отладке в эмуляторе Android или симуляторе iOS динамическая перезагрузка использует localhost для обмена данными. Если вы хотите выполнить развертывание на устройстве, устройство и компьютер должны находиться в одной сети Wi-Fi. В сценариях, где это невозможно, можно [настроить собственный сервер динамической перезагрузки](#live-reload-server), который позволит выполнить динамическую перезагрузку независимо от параметров сетевого подключения.

### <a name="does-it-require-debugging-the-app"></a>Требуется ли отладка приложения? 

Нет. На самом деле, можно даже запустить все поддерживаемые целевые приложения (Android, iOS и UWP) на любом числе устройств, симуляторов и эмуляторах, а также просмотреть все обновления одновременно. 

## <a name="limitations"></a>Ограничения

* Поддерживается только перезагрузка XAML.
* Состояние пользовательского интерфейса между повторным развертыванием может не поддерживаться, если не используется MVVM.

## <a name="known-issues"></a>Известные проблемы

* Поддерживается только в Visual Studio.
* Компоновка должна быть настроена на **не только компоновку** , но и **компоновку пакетов SDK для инфраструктуры** 
* Перезагрузка ресурсов на уровне приложения (т. е. файлов **app. XAML** или общих словарей ресурсов), Навигация по приложениям сбрасывается. 
* Перезагрузка ContentView в настоящее время требует перезагрузки содержащей его страницы.
* Элементы, содержащие AutomationId, могут вызвать сбой перезагрузки.
* Изменение XAML во время отладки UWP может привести к сбою среды выполнения. Обходное решение. Используйте команду **запустить без отладки (CTRL + F5)** , а не **начать отладку (F5)** .

## <a name="troubleshooting"></a>Диагностика

### <a name="error-codes"></a>Коды ошибок

* **XLR001**: *текущий проект ссылается на "Xamarin. LiveReload" версии пакета NUGET "[версия]", но для расширения Xamarin динамической перезагрузки требуется версия "[версия]".*

  Чтобы обеспечить быструю итерацию и развитие функции динамической перезагрузки, пакет NuGet и расширение Visual Studio должны точно совпадать. Обновите пакет NuGet до той же версии установленного расширения.

* **XLR002**: *для динамической перезагрузки требуется по крайней мере свойство "мктсостнаме" при сборке из командной строки. Также можно задать для "Енаблеливерелоад" значение "false", чтобы отключить функцию.*

  Свойства, необходимые для динамической перезагрузки, недоступны при сборке из командной строки (или при непрерывной интеграции) и поэтому должны быть предоставлены явным образом. 

* **XLR003**: *для перезагрузки пакета NuGet требуется установка расширения Visual Studio для динамической перезагрузки Xamarin.*

  Попытка построить проект, который ссылается на пакет NuGet динамической перезагрузки, но расширение визуального элемента не установлено.  

* *Исключение при загрузке сборок: System. IO. FileNotFoundException: не удалось загрузить сборку Xamarin. Live. Reload, Version = 0.3.27.0, Culture = Neutral, PublicKeyToken = ".*

  Проект размещения должен использовать `PackageReference` вместо `packages.config`

### <a name="app-doesnt-connect"></a>Приложение не подключается

При построении приложения сведения из **средств > параметры > Xamarin > динамической перезагрузке** (имя узла, ключ порта и ключи шифрования) внедряются в приложение, поэтому при запуске `LiveReload.Init()` не требуется связывание или настройка для выполнения подключения.

В отличие от обычных сетевых проблем (брандмауэр, устройство в другой сети), основная причина, по которой приложение не может успешно подключиться к IDE, заключается в том, что его конфигурация отличается от конфигурации в Visual Studio. Это может произойти, если:

* Приложение было скомпилировано на другом компьютере.
* Приложение было скомпилировано и развернуто в другом сеансе Visual Studio, и **автоматически создавать ключи шифрования** (по умолчанию) в **меню сервис > параметры > Xamarin > Динамическая перезагрузка**.
* Параметры Visual Studio изменены (т. е. имя узла, порт или ключи шифрования), но приложение не было собрано и развернуто повторно.

Все эти случаи решены путем сборки и развертывания приложения.

### <a name="uninstalling-preview-1"></a>Удаление предварительной версии 1

Если у вас есть более старая Предварительная версия и у вас возникли проблемы с удалением, выполните следующие действия.

1. Удалите папку **C:\Program Files (x86) \Microsoft Visual Studio\Preview\Enterprise\Common7\IDE\Extensions\Xamarin\LiveReload** (Примечание. Замените "Enterprise" на установленный выпуск, а "Предварительная версия" на "2017" при установке в стабильной среде VS)
2. Откройте **командную строку разработчика** для этого Visual Studio и запустите `devenv /updateconfiguration`. 

## <a name="tips--tricks"></a>Советы & рекомендации

* При условии, что параметры динамической перезагрузки не изменяются (включая ключи шифрования, например, если вы отключаете **Автоматическое создание ключей шифрования**) и выполняете сборку с того же компьютера, вам не нужно создавать и развертывать приложение после первоначального развертывания, если не изменить код или зависимости. Можно просто запустить ранее развернутое приложение, которое будет подключаться к последнему используемому узлу.

* Не существует ограничений на количество устройств, которые можно подключить к одному сеансу Visual Studio. Вы можете развернуть и запустить приложение в максимальном количестве устройств или симуляторов, чтобы увидеть, как будет работать динамическая перезагрузка на всех этих устройствах одновременно.

* При динамической перезагрузке будут перезагружены только часть пользовательского интерфейса приложения, но *страницы не создаются повторно,* ни одна из них не заменяет модель представления (или контекст привязки). Это означает, что *все* состояние приложения всегда сохраняется во всех перегрузках, включая внедренные зависимости.

## <a name="live-reload-server"></a>Сервер динамической перезагрузки

В сценариях, в которых подключение из запущенного приложения к компьютеру (как указано с помощью `localhost` или `127.0.0.1` в **меню сервис > параметры > Xamarin > динамической перезагрузке**) невозможно (т. е. брандмауэры, разные сети), можно настроить удаленный сервер, который будет подключиться как интегрированная среда разработки, так и приложение.

Динамическая перезагрузка использует стандартный [протокол MQTT](https://mqtt.org/) для обмена сообщениями и поэтому может взаимодействовать с [серверами сторонних производителей](https://github.com/mqtt/mqtt.github.io/wiki/servers). Доступны даже общедоступные [серверы](https://github.com/mqtt/mqtt.github.io/wiki/public_brokers) (также называемые *брокерами*), которые можно использовать. Динамическая перезагрузка была протестирована с именами узлов `broker.hivemq.com` и `iot.eclipse.org`, а также службами, предоставляемыми [www.cloudmqtt.com](https://www.cloudmqtt.com) и [www.cloudamqp.com](https://www.cloudamqp.com). Вы также можете развернуть собственный сервер MQTT в облаке, например [хивемк в Azure](https://www.hivemq.com/blog/hivemq-on-windows-azure-mqtt-microsoft-cloud).

Можно настроить любой порт, но обычно для удаленных серверов используется порт 1883 по умолчанию. В сообщениях динамической перезагрузки используется надежное сквозное симметричное шифрование AES, чтобы обеспечить безопасность подключения к удаленным серверам. По умолчанию ключ шифрования и вектор инициализации (IV) создаются повторно в каждом сеансе Visual Studio.

Возможно, самый простой способ — установить сервер [москуитто](https://mosquitto.org) в ПУСТую виртуальную машину Ubuntu в Azure:

1. Создание новой виртуальной машины Ubuntu Server на портале Azure
2. Добавьте новое правило для входящего порта для 1883 (порт MQTT по умолчанию) на вкладке "сеть".
3. Открытие [Cloud Shell](https://docs.microsoft.com/azure/cloud-shell/overview) (режим bash)
4. Введите `ssh [USERNAME]@[PUBLIC_IP]`, используя имя пользователя, выбранное в 1), и общедоступный IP-адрес, показанный на странице обзора виртуальной машины.
5. Запустите `sudo apt-get install mosquitto`, введя пароль, выбранный в 1).

Теперь вы можете использовать этот IP-адрес для подключения к собственному серверу MQTT.
